<controls:OobeStep
    x:Class="Polymerium.App.Components.OobePrivilege"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:components="clr-namespace:Polymerium.App.Components"
    xmlns:controls="clr-namespace:Polymerium.App.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fi="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
    xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
    xmlns:lang="https://github.com/d3ara1n/Polymerium/Languages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    d:DesignHeight="400"
    d:DesignWidth="480"
    mc:Ignorable="d">
    <StackPanel
        Margin="24,0"
        HorizontalAlignment="Stretch"
        VerticalAlignment="Center"
        Spacing="16">
        <!--  Unified Header  -->
        <StackPanel
            HorizontalAlignment="Center"
            Spacing="8">
            <Border
                Width="64"
                Height="64"
                HorizontalAlignment="Center"
                Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                CornerRadius="32">
                <fi:SymbolIcon
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="32"
                    Foreground="{StaticResource AccentFillColorDefaultBrush}"
                    Symbol="Key" />
            </Border>
            <TextBlock
                HorizontalAlignment="Center"
                FontSize="{StaticResource LargeFontSize}"
                FontWeight="{StaticResource ControlStrongFontWeight}"
                Text="{x:Static lang:Resources.OobePrivilege_Title}" />
            <TextBlock
                HorizontalAlignment="Center"
                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                Text="{x:Static lang:Resources.OobePrivilege_Subtitle}" />
        </StackPanel>

        <!--  Status Card - Changes based on privilege state  -->
        <husk:SwitchPresenter
            TargetType="x:Boolean"
            Value="{Binding $parent[components:OobePrivilege].IsPrivilegeGranted}">
            <!--  Privilege Granted - Success Card  -->
            <husk:SwitchCase Value="{x:True}">
                <Border
                    Padding="12,10"
                    Background="{StaticResource ControlSuccessTranslucentFullBackgroundBrush}"
                    CornerRadius="{StaticResource MediumCornerRadius}">
                    <Grid ColumnDefinitions="Auto,12,*">
                        <fi:SymbolIcon
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            FontSize="24"
                            Foreground="{StaticResource ControlSuccessForegroundBrush}"
                            Symbol="CheckmarkCircle" />
                        <StackPanel
                            Grid.Column="2"
                            VerticalAlignment="Center">
                            <TextBlock
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Text="{x:Static lang:Resources.OobePrivilege_StatusGrantedTitle}" />
                            <TextBlock
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{x:Static lang:Resources.OobePrivilege_StatusGrantedMessage}"
                                TextWrapping="Wrap" />
                        </StackPanel>
                    </Grid>
                </Border>
            </husk:SwitchCase>

            <!--  Privilege Required - Warning Card  -->
            <husk:SwitchCase Value="{x:False}">
                <Border
                    Padding="12,10"
                    Background="{StaticResource ControlWarningTranslucentFullBackgroundBrush}"
                    CornerRadius="{StaticResource MediumCornerRadius}">
                    <Grid ColumnDefinitions="Auto,12,*,Auto">
                        <fi:SymbolIcon
                            Grid.Column="0"
                            VerticalAlignment="Center"
                            FontSize="24"
                            Foreground="{StaticResource ControlWarningForegroundBrush}"
                            Symbol="Warning" />
                        <StackPanel
                            Grid.Column="2"
                            VerticalAlignment="Center">
                            <TextBlock
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Text="{x:Static lang:Resources.OobePrivilege_StatusRequiredTitle}" />
                            <TextBlock
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{x:Static lang:Resources.OobePrivilege_StatusRequiredMessage}"
                                TextWrapping="Wrap" />
                        </StackPanel>
                        <Button
                            Classes="Small"
                            Grid.Column="3"
                            Command="{Binding $parent[components:OobePrivilege].CheckPrivilegeCommand}"
                            Theme="{StaticResource GhostButtonTheme}">
                            <fi:SymbolIcon
                                FontSize="{StaticResource SmallFontSize}"
                                Symbol="ArrowClockwise" />
                        </Button>
                    </Grid>
                </Border>
            </husk:SwitchCase>
        </husk:SwitchPresenter>

        <!--  Instructions Card (always visible)  -->
        <Border
            Padding="12,10"
            Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
            CornerRadius="{StaticResource MediumCornerRadius}">
            <StackPanel Spacing="8">
                <TextBlock
                    FontWeight="{StaticResource ControlStrongFontWeight}"
                    Text="{x:Static lang:Resources.OobePrivilege_InstructionsTitle}" />
                <TextBlock
                    FontSize="{StaticResource SmallFontSize}"
                    Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                    Text="{x:Static lang:Resources.OobePrivilege_InstructionsDescription}"
                    TextWrapping="Wrap" />
                <HyperlinkButton
                    HorizontalAlignment="Left"
                    NavigateUri="ms-settings:developers">
                    <StackPanel
                        Orientation="Horizontal"
                        Spacing="4">
                        <fi:SymbolIcon
                            FontSize="{StaticResource SmallFontSize}"
                            Symbol="Open" />
                        <TextBlock Text="{x:Static lang:Resources.OobePrivilege_OpenSettingsButtonText}" />
                    </StackPanel>
                </HyperlinkButton>
            </StackPanel>
        </Border>

        <!--  Safety Note  -->
        <TextBlock
            MaxWidth="400"
            HorizontalAlignment="Center"
            FontSize="{StaticResource SmallFontSize}"
            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
            TextAlignment="Center"
            TextWrapping="Wrap">
            <Run
                Text="{x:Static lang:Resources.OobePrivilege_SafetyNote}"
                TextDecorations="Underline" />
            <LineBreak />
            <Run Text="{x:Static lang:Resources.OobePrivilege_SafetyDescription}" />
        </TextBlock>
    </StackPanel>
</controls:OobeStep>
