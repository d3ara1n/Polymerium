<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:icons="https://github.com/MahApps/IconPacks.Avalonia"
             xmlns:m="using:Polymerium.App.Models"
             xmlns:cp="using:Polymerium.App.Components"
             xmlns:fie="using:FluentIcons.Avalonia.MarkupExtensions"
             xmlns:controls="clr-namespace:Polymerium.App.Controls"
             xmlns:huskc="https://github.com/d3ara1n/Huskui.Avalonia/Converters"
             xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="Polymerium.App.Components.PackageContainer">
    <Grid RowDefinitions="Auto,0,*">
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Margin="16,8" ColumnSpacing="12">
            <TextBox Grid.Column="0" Watermark="Enter filter string..."
                     MinWidth="168"
                     Text="{Binding $parent[cp:PackageContainer].FilterText,Mode=OneWayToSource}">
                <TextBox.InnerRightContent>
                    <StackPanel Orientation="Horizontal">
                        <Button
                            IsVisible="{Binding $parent[TextBox].Text,Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                            Command="{Binding $parent[TextBox].Clear}"
                            Content="{fie:SymbolIcon Symbol=Dismiss,FontSize={StaticResource MediumFontSize}}"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                        <Button>
                            <Button.Flyout>
                                <Flyout>
                                    <StackPanel Spacing="8" MinWidth="320" MaxWidth="520" MaxHeight="360" Margin="12">
                                        <TextBlock Text="Filter" FontSize="{StaticResource SmallFontSize}"
                                                   Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                   VerticalAlignment="Center" />
                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                                            <TextBlock Grid.Column="0" Text="Status" VerticalAlignment="Bottom" />
                                            <TabStrip Grid.Column="1" Theme="{StaticResource SegmentedTabStripTheme}">
                                                <TabStripItem Content="All" />
                                                <TabStripItem Content="Enabled" />
                                                <TabStripItem Content="Disabled" />
                                            </TabStrip>
                                        </Grid>
                                        <husk:Divider />
                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                                            <TextBlock Grid.Column="0" Text="Source" VerticalAlignment="Bottom" />
                                            <TabStrip Grid.Column="1" Theme="{StaticResource SegmentedTabStripTheme}">
                                                <TabStripItem Content="All" />
                                                <TabStripItem Content="Original" />
                                                <TabStripItem Content="Local" />
                                            </TabStrip>
                                        </Grid>
                                        <husk:Divider />
                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                                            <TextBlock Grid.Column="0" Text="Type" VerticalAlignment="Bottom" />
                                            <TabStrip Grid.Column=" 1" Theme="{StaticResource SegmentedTabStripTheme}">
                                                <TabStripItem Content="All" />
                                                <TabStripItem Content="Mod" />
                                                <TabStripItem Content="ResourcePack" />
                                                <TabStripItem Content="ShaderPack" />
                                                <TabStripItem Content="DataPack" />
                                            </TabStrip>
                                        </Grid>
                                        <husk:Divider />
                                        <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="24">
                                            <TextBlock Grid.Column="0" Text="Tags" VerticalAlignment="Center"
                                                       FontSize="{StaticResource SmallFontSize}"
                                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                            <Button Grid.Column="1" Theme="{StaticResource GhostButtonTheme}"
                                                    Classes="Small">
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <icons:PackIconLucide Kind="SquareCheck"
                                                                          Height="{StaticResource SmallFontSize}"
                                                                          Width="{StaticResource SmallFontSize}"
                                                                          VerticalAlignment="Center" />
                                                    <TextBlock Text="Check All" />
                                                </StackPanel>
                                            </Button>
                                            <Button Grid.Column="2" Theme="{StaticResource GhostButtonTheme}"
                                                    Classes="Small">
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <icons:PackIconLucide Kind="SquareDashed"
                                                                          Height="{StaticResource SmallFontSize}"
                                                                          Width="{StaticResource SmallFontSize}"
                                                                          VerticalAlignment="Center" />
                                                    <TextBlock Text="Uncheck All" />
                                                </StackPanel>
                                            </Button>
                                        </Grid>
                                        <Panel MinHeight="120">
                                            <StackPanel VerticalAlignment="Center"
                                                        Spacing="8">
                                                <icons:PackIconLucide Kind="Tags"
                                                                      Height="{StaticResource ExtraLargeFontSize}"
                                                                      Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                                      Width="{StaticResource ExtraLargeFontSize}"
                                                                      HorizontalAlignment="Center" />
                                                <TextBlock Text="WIP" FontSize="{StaticResource LargeFontSize}"
                                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                           HorizontalAlignment="Center" />
                                            </StackPanel>
                                            <ItemsControl>
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <WrapPanel ItemSpacing="8" LineSpacing="8" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Border CornerRadius="{StaticResource SmallCornerRadius}"
                                                                BorderBrush="{StaticResource ControlBorderBrush}"
                                                                BorderThickness="1" Padding="8">
                                                            <CheckBox Content="Gameplay" />
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Panel>
                                    </StackPanel>
                                </Flyout>
                            </Button.Flyout>
                            <icons:PackIconLucide Kind="ListFilter" Height="{StaticResource MediumFontSize}"
                                                  Width="{StaticResource MediumFontSize}" />
                        </Button>
                    </StackPanel>

                </TextBox.InnerRightContent>
            </TextBox>
            <TextBlock Grid.Column="1">
                <Run Text="Results"
                     Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                <LineBreak />
                <Run Text="{Binding $parent[cp:PackageContainer].View.Count,Mode=OneWay,FallbackValue=0}" />
                <Run Text="/" Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                <Run Text="{Binding $parent[cp:PackageContainer].TotalCount,Mode=OneWay,FallbackValue=0}" />
            </TextBlock>
            <StackPanel Grid.Column="2" DockPanel.Dock="Right" Orientation="Horizontal" Spacing="8">
                <Button Content="Bulk Update" />
                <Button Content="Export List" />
                <Button Classes="Primary" Command="{Binding $parent[cp:PackageContainer].GotoExplorerCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <icons:PackIconLucide Kind="WandSparkles" Height="{StaticResource MediumFontSize}"
                                              VerticalAlignment="Center" />
                        <TextBlock Text="Get" />
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
        <Panel Grid.Row="2">
            <StackPanel VerticalAlignment="Center"
                        IsVisible="{Binding $parent[cp:PackageContainer].View.Count,Converter={x:Static huskc:NumberConverters.IsZero},FallbackValue=False}"
                        Spacing="8">
                <icons:PackIconLucide Kind="Package" Height="{StaticResource ExtraLargeFontSize}"
                                      Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                      Width="{StaticResource ExtraLargeFontSize}" HorizontalAlignment="Center" />
                <TextBlock Text="No Entries" FontSize="{StaticResource LargeFontSize}"
                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" HorizontalAlignment="Center" />
            </StackPanel>
            <ScrollViewer>
                <ItemsControl Margin="{StaticResource PageToplessContentMargin}"
                              ItemsSource="{Binding $parent[cp:PackageContainer].View}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="m:InstancePackageModel">
                            <controls:PackageEntryButton Margin="0,3"
                                                         Command="{Binding PrimaryCommand,RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=cp:PackageContainer}}"
                                                         CommandParameter="{Binding }">
                                <controls:PackageEntryButton.ContextFlyout>
                                    <MenuFlyout x:DataType="m:InstancePackageModel">
                                        <MenuItem Header="Active"
                                                  IsChecked="{Binding IsEnabled,Mode=TwoWay}"
                                                  ToggleType="CheckBox"
                                                  IsEnabled="{Binding IsLocked,Converter={x:Static BoolConverters.Not}}"
                                                  Icon="{fie:SymbolIcon Symbol=Star,FontSize={StaticResource MediumFontSize}}" />
                                        <MenuItem Header="-" />
                                        <MenuItem Header="Open Website"
                                                  Command="{x:Static m:InternalCommands.OpenUriCommand}"
                                                  CommandParameter="{Binding Reference}"
                                                  Icon="{fie:SymbolIcon Symbol=Open,FontSize={StaticResource MediumFontSize}}" />
                                        <!-- <MenuItem Header="Add to Favorites" -->
                                        <!--           Icon="{fie:SymbolIcon Symbol=CollectionsAdd,FontSize={StaticResource MediumFontSize}}" /> -->
                                        <!-- <MenuItem Header="Remove from Favorite" -->
                                        <!--           Icon="{fie:SymbolIcon Symbol=Collections,FontSize={StaticResource MediumFontSize}}" /> -->
                                        <MenuItem Header="-" />
                                        <MenuItem Header="Remove"
                                                  Command="{Binding $parent[cp:PackageContainer].RemoveCommand,Mode=OneWay}"
                                                  CommandParameter="{Binding }"
                                                  IsEnabled="{Binding IsLocked,Converter={x:Static BoolConverters.Not}}"
                                                  Icon="{fie:SymbolIcon Symbol=Delete,FontSize={StaticResource MediumFontSize}}" />
                                    </MenuFlyout>
                                </controls:PackageEntryButton.ContextFlyout>
                            </controls:PackageEntryButton>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <VirtualizingStackPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Panel>
    </Grid>
</UserControl>