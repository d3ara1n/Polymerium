<husk:Toast
    x:Class="Polymerium.App.Toasts.ExhibitModpackToast"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:async="using:AsyncImageLoader"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fi="using:FluentIcons.Avalonia"
    xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
    xmlns:lang="https://github.com/d3ara1n/Polymerium/Languages"
    xmlns:local="clr-namespace:Polymerium.App.Toasts"
    xmlns:m="using:Polymerium.App.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:md="https://github.com/whistyun/Markdown.Avalonia.Tight"
    xmlns:mdxaml="https://github.com/whistyun/Markdown.Avalonia"
    xmlns:trident="using:Trident.Abstractions.Repositories.Resources"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:DataType="m:ExhibitModpackModel"
    Header="{Binding ProjectName, FallbackValue=Display}"
    mc:Ignorable="d">
    <StackPanel Spacing="24">
        <Border
            Padding="12"
            Background="{StaticResource ControlTranslucentHalfBackgroundBrush}"
            BorderBrush="{StaticResource ControlBorderBrush}"
            BorderThickness="1"
            CornerRadius="{StaticResource MediumCornerRadius}">
            <husk:LazyContainer
                MinHeight="100"
                Source="{Binding $parent[local:ExhibitModpackToast].LazyVersions, Mode=OneWay}">
                <husk:LazyContainer.SourceTemplate>
                    <DataTemplate DataType="m:ExhibitVersionCollection">
                        <StackPanel Spacing="12">
                            <Grid
                                ColumnDefinitions="*,Auto,Auto"
                                ColumnSpacing="8">
                                <ItemsControl
                                    Grid.Column="0"
                                    ItemsSource="{Binding $parent[local:ExhibitModpackToast].((m:ExhibitModpackModel)DataContext).Tags, FallbackValue={x:Null}}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="x:String">
                                            <husk:Tag
                                                Content="{Binding}"
                                                FontSize="{StaticResource MediumFontSize}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <WrapPanel
                                                ItemSpacing="4"
                                                LineSpacing="4"
                                                Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                                <TextBlock
                                    Grid.Column="1"
                                    Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                    Text="{Binding $parent[local:ExhibitModpackToast].((m:ExhibitModpackModel)DataContext).AuthorName, StringFormat={}@{0}, FallbackValue=Author}" />
                                <HyperlinkButton
                                    Grid.Column="2"
                                    NavigateUri="{Binding $parent[local:ExhibitModpackToast].((m:ExhibitModpackModel)DataContext).Reference, FallbackValue=LABEL, Converter={x:Static husk:StringConverters.ToUpper}}">
                                    <ToolTip.Tip>
                                        <StackPanel Spacing="2">
                                            <Grid
                                                ColumnDefinitions="*,Auto"
                                                ColumnSpacing="4">
                                                <TextBlock
                                                    Grid.Column="0"
                                                    FontSize="{StaticResource SmallFontSize}"
                                                    Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                    Text="{x:Static lang:Resources.Shared_ExternalLinkLabelText}" />
                                                <fi:SymbolIcon
                                                    Grid.Column="1"
                                                    FontSize="{StaticResource MediumFontSize}"
                                                    Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                    Symbol="Open" />
                                            </Grid>
                                            <TextBlock Text="{Binding $parent[HyperlinkButton].NavigateUri}" />
                                        </StackPanel>
                                    </ToolTip.Tip>
                                    <StackPanel
                                        Orientation="Horizontal"
                                        Spacing="4">
                                        <TextBlock Text="{Binding $parent[local:ExhibitModpackToast].((m:ExhibitModpackModel)DataContext).Label, FallbackValue=Label, Converter={x:Static husk:StringConverters.ToUpper}}" />
                                        <fi:SymbolIcon
                                            FontSize="{StaticResource MediumFontSize}"
                                            Symbol="Open" />
                                    </StackPanel>
                                </HyperlinkButton>
                            </Grid>
                            <TextBlock
                                Text="{Binding $parent[local:ExhibitModpackToast].((m:ExhibitModpackModel)DataContext).Summary, FallbackValue=Display}"
                                TextWrapping="Wrap" />
                            <Grid
                                ColumnDefinitions="Auto,Auto,*"
                                ColumnSpacing="12">
                                <Button
                                    Classes="Primary"
                                    Grid.Column="0"
                                    Command="{Binding $parent[local:ExhibitModpackToast].InstallCommand}"
                                    CommandParameter="{Binding $parent[local:ExhibitModpackToast].SelectedVersion, Mode=OneWay, FallbackValue={x:Null}}">
                                    <StackPanel
                                        Margin="6,0"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                        <fi:SymbolIcon
                                            FontSize="{StaticResource MediumFontSize}"
                                            Symbol="ArrowDownload" />
                                        <TextBlock Text="{x:Static lang:Resources.ExhibitModpackToast_InstallButtonText}" />
                                    </StackPanel>
                                </Button>
                                <Button
                                    Grid.Column="1"
                                    IsVisible="False">
                                    <fi:SymbolIcon
                                        FontSize="{StaticResource MediumFontSize}"
                                        Symbol="Bookmark" />
                                </Button>
                                <ComboBox
                                    Name="VersionBox"
                                    Grid.Column="2"
                                    ItemsSource="{Binding}"
                                    SelectedItem="{Binding $parent[local:ExhibitModpackToast].SelectedVersion, Mode=TwoWay, FallbackValue={x:Null}}">
                                    <ComboBox.SelectionBoxItemTemplate>
                                        <DataTemplate DataType="m:ExhibitVersionModel">
                                            <Grid
                                                ColumnDefinitions="Auto,*,Auto"
                                                ColumnSpacing="4">
                                                <husk:SwitchPresenter
                                                    Grid.Column="0"
                                                    TargetType="trident:ReleaseType"
                                                    Value="{Binding TypeRaw, FallbackValue=Release}">
                                                    <husk:SwitchCase Value="Release">
                                                        <husk:Tag
                                                            Classes="Success Small"
                                                            CornerRadius="{StaticResource SmallCornerRadius}">
                                                            <TextBlock Text="{x:Static lang:Resources.ReleaseType_Release}" />
                                                        </husk:Tag>
                                                    </husk:SwitchCase>
                                                    <husk:SwitchCase Value="Beta">
                                                        <husk:Tag
                                                            Classes="Warning Small"
                                                            CornerRadius="{StaticResource SmallCornerRadius}">
                                                            <TextBlock Text="{x:Static lang:Resources.ReleaseType_Beta}" />
                                                        </husk:Tag>
                                                    </husk:SwitchCase>
                                                    <husk:SwitchCase Value="Alpha">
                                                        <husk:Tag
                                                            Classes="Danger Small"
                                                            CornerRadius="{StaticResource SmallCornerRadius}">
                                                            <TextBlock Text="{x:Static lang:Resources.ReleaseType_Alpha}" />
                                                        </husk:Tag>
                                                    </husk:SwitchCase>
                                                </husk:SwitchPresenter>
                                                <TextBlock
                                                    Grid.Column="1"
                                                    Text="{Binding VersionName, FallbackValue=Display}" />
                                                <TextBlock
                                                    Grid.Column="2"
                                                    VerticalAlignment="Center"
                                                    Background="Transparent"
                                                    FontSize="{StaticResource SmallFontSize}"
                                                    Text="{Binding PublishedAt}"
                                                    ToolTip.Tip="{Binding PublishedAtRaw}" />
                                            </Grid>
                                        </DataTemplate>
                                    </ComboBox.SelectionBoxItemTemplate>
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate DataType="m:ExhibitVersionModel">
                                            <StackPanel Spacing="4">
                                                <Grid
                                                    ColumnDefinitions="Auto,*"
                                                    ColumnSpacing="4">
                                                    <husk:SwitchPresenter
                                                        Grid.Column="0"
                                                        TargetType="trident:ReleaseType"
                                                        Value="{Binding TypeRaw, FallbackValue=Release}">
                                                        <husk:SwitchCase Value="Release">
                                                            <husk:Tag
                                                                Classes="Success"
                                                                CornerRadius="{StaticResource SmallCornerRadius}">
                                                                <TextBlock Text="{x:Static lang:Resources.ReleaseType_Release}" />
                                                            </husk:Tag>
                                                        </husk:SwitchCase>
                                                        <husk:SwitchCase Value="Beta">
                                                            <husk:Tag
                                                                Classes="Warning"
                                                                CornerRadius="{StaticResource SmallCornerRadius}">
                                                                <TextBlock Text="{x:Static lang:Resources.ReleaseType_Beta}" />
                                                            </husk:Tag>
                                                        </husk:SwitchCase>
                                                        <husk:SwitchCase Value="Alpha">
                                                            <husk:Tag
                                                                Classes="Danger"
                                                                CornerRadius="{StaticResource SmallCornerRadius}">
                                                                <TextBlock Text="{x:Static lang:Resources.ReleaseType_Alpha}" />
                                                            </husk:Tag>
                                                        </husk:SwitchCase>
                                                    </husk:SwitchPresenter>
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        Text="{Binding VersionName, FallbackValue=Display}"
                                                        TextTrimming="CharacterEllipsis" />
                                                </Grid>
                                                <Grid
                                                    ColumnDefinitions="Auto,Auto,*"
                                                    ColumnSpacing="4">
                                                    <husk:IconLabel
                                                        Grid.Column="0"
                                                        Background="Transparent"
                                                        FontSize="{StaticResource SmallFontSize}"
                                                        Icon="Calendar"
                                                        Text="{Binding PublishedAt}"
                                                        ToolTip.Tip="{Binding PublishedAtRaw}" />
                                                    <husk:IconLabel
                                                        Grid.Column="1"
                                                        FontSize="{StaticResource SmallFontSize}"
                                                        Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                        Icon="Flag"
                                                        Text="{Binding CompatibleLoaders}" />
                                                    <husk:IconLabel
                                                        Grid.Column="2"
                                                        FontSize="{StaticResource SmallFontSize}"
                                                        Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                        Icon="Branch"
                                                        Text="{Binding CompatibleVersions}"
                                                        TextBlock.TextTrimming="CharacterEllipsis" />
                                                </Grid>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </Grid>
                        </StackPanel>
                    </DataTemplate>
                </husk:LazyContainer.SourceTemplate>
            </husk:LazyContainer>
        </Border>
        <husk:ConstrainedBox
            IsVisible="{Binding Gallery, Converter={x:Static husk:CollectionConverters.IsNotEmpty}}"
            AspectRatio="16:9">
            <Panel>
                <Carousel
                    Name="GalleryCarousel"
                    CornerRadius="{Binding Source={StaticResource LargeCornerRadius}}"
                    ItemsSource="{Binding Gallery}">
                    <Carousel.ItemTemplate>
                        <DataTemplate x:DataType="x:Uri">
                            <Image
                                async:ImageLoader.Source="{Binding}"
                                RenderOptions.BitmapInterpolationMode="HighQuality"
                                Stretch="UniformToFill" />
                        </DataTemplate>
                    </Carousel.ItemTemplate>
                </Carousel>
                <Border
                    HorizontalAlignment="Center"
                    VerticalAlignment="Bottom"
                    Background="Transparent">
                    <husk:PipsPager
                        ItemCount="{Binding #GalleryCarousel.ItemCount}"
                        SelectedIndex="{Binding #GalleryCarousel.SelectedIndex, Mode=TwoWay}" />
                </Border>
            </Panel>
        </husk:ConstrainedBox>
        <husk:LazyContainer Source="{Binding $parent[local:ExhibitModpackToast].LazyDescription, Mode=OneWay}">
            <husk:LazyContainer.SourceTemplate>
                <DataTemplate DataType="x:String">
                    <mdxaml:MarkdownScrollViewer Markdown="{Binding}">
                        <mdxaml:MarkdownScrollViewer.Engine>
                            <md:Markdown HyperlinkCommand="{Binding $parent[local:ExhibitModpackToast].NavigateUriCommand}" />
                        </mdxaml:MarkdownScrollViewer.Engine>
                    </mdxaml:MarkdownScrollViewer>
                </DataTemplate>
            </husk:LazyContainer.SourceTemplate>
        </husk:LazyContainer>
    </StackPanel>
</husk:Toast>
