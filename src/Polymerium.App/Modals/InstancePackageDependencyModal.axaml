<husk:Modal xmlns="https://github.com/avaloniaui"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
            xmlns:m="using:Polymerium.App.Models"
            xmlns:modals="using:Polymerium.App.Modals"
            xmlns:fi="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
            xmlns:trident="clr-namespace:Trident.Abstractions.Repositories.Resources;assembly=Trident.Abstractions"
            xmlns:lang="https://github.com/d3ara1n/Polymerium/Languages"
            mc:Ignorable="d" d:DesignHeight="500" d:DesignWidth="360" MinWidth="360" Margin="64"
            x:Class="Polymerium.App.Modals.InstancePackageDependencyModal"
            x:DataType="m:InstancePackageDependencyModel">
    <husk:ConstrainedBox AspectRatio="0.75">
        <Grid RowDefinitions="Auto,*,Auto" RowSpacing="12">
            <!-- Header -->
            <Border Grid.Row="0" Background="{StaticResource ControlTranslucentHalfBackgroundBrush}" Padding="12"
                    CornerRadius="{StaticResource MediumCornerRadius}">
                <Grid ColumnDefinitions="Auto,*" RowDefinitions="*,*" ColumnSpacing="12">
                    <Border Grid.Row="0" Grid.RowSpan="2" Grid.Column="0" Height="48" Width="48"
                            CornerRadius="{StaticResource SmallCornerRadius}">
                        <Border.Background>
                            <ImageBrush Source="{Binding Thumbnail,FallbackValue={x:Null}}" />
                        </Border.Background>
                    </Border>
                    <TextBlock Grid.Row="0" Grid.Column="1"
                               Text="{Binding ProjectName,FallbackValue=Project}"
                               FontWeight="{StaticResource ControlStrongFontWeight}"
                               FontSize="{StaticResource LargeFontSize}" VerticalAlignment="Center" />
                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Spacing="4"
                                VerticalAlignment="Center">
                        <TextBlock
                            Text="{Binding Label,FallbackValue=Label,Converter={x:Static husk:StringConverters.ToUpper}}"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                        <husk:Tag Content="{x:Static lang:Resources.InstancePackageDependencyButton_RequiredTagText}"
                                  IsVisible="{Binding IsRequired}" Classes="Warning" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Version List -->
            <Grid Grid.Row="1" RowDefinitions="Auto,*" RowSpacing="8">
                <CheckBox Grid.Row="0"
                          Content="{x:Static lang:Resources.InstancePackageModal_FilterLabelText}"
                          IsChecked="{Binding $parent[modals:InstancePackageDependencyModal].IsFilterEnabled,Mode=TwoWay}" />
                <husk:LazyContainer Grid.Row="1"
                                    Source="{Binding $parent[modals:InstancePackageDependencyModal].LazyVersions}">
                    <husk:LazyContainer.SourceTemplate>
                        <DataTemplate DataType="m:InstancePackageVersionCollection">
                            <ListBox ItemsSource="{Binding}"
                                     SelectedItem="{Binding $parent[modals:InstancePackageDependencyModal].SelectedVersion,Mode=TwoWay,FallbackValue={x:Null}}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate DataType="m:InstancePackageVersionModel">
                                        <StackPanel Spacing="4">
                                            <DockPanel>
                                                <husk:SwitchPresenter
                                                    DockPanel.Dock="Right"
                                                    TargetType="trident:ReleaseType"
                                                    Value="{Binding ReleaseTypeRaw,FallbackValue=Release}">
                                                    <husk:SwitchCase Value="Release">
                                                        <husk:Tag Classes="Success"
                                                                  CornerRadius="{StaticResource SmallCornerRadius}">
                                                            <TextBlock
                                                                Text="{x:Static lang:Resources.ReleaseType_Release}" />
                                                        </husk:Tag>
                                                    </husk:SwitchCase>
                                                    <husk:SwitchCase Value="Beta">
                                                        <husk:Tag Classes="Warning"
                                                                  CornerRadius="{StaticResource SmallCornerRadius}">
                                                            <TextBlock
                                                                Text="{x:Static lang:Resources.ReleaseType_Beta}" />
                                                        </husk:Tag>
                                                    </husk:SwitchCase>
                                                    <husk:SwitchCase Value="Alpha">
                                                        <husk:Tag Classes="Danger"
                                                                  CornerRadius="{StaticResource SmallCornerRadius}">
                                                            <TextBlock
                                                                Text="{x:Static lang:Resources.ReleaseType_Alpha}" />
                                                        </husk:Tag>
                                                    </husk:SwitchCase>
                                                </husk:SwitchPresenter>
                                                <TextBlock Text="{Binding Name,FallbackValue=Display}" />
                                            </DockPanel>
                                            <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto" ColumnSpacing="4">
                                                <fi:SymbolIcon Grid.Column="0" Symbol="Flag"
                                                               FontSize="{StaticResource SmallFontSize}"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding CompatibleLoaders}"
                                                           FontSize="{StaticResource SmallFontSize}"
                                                           TextTrimming="CharacterEllipsis"
                                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                <fi:SymbolIcon Grid.Column="2" Symbol="Branch"
                                                               FontSize="{StaticResource SmallFontSize}"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                <TextBlock Grid.Column="3"
                                                           Text="{Binding CompatibleVersions}"
                                                           FontSize="{StaticResource SmallFontSize}"
                                                           TextTrimming="CharacterEllipsis"
                                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                <TextBlock Grid.Column="4"
                                                           FontSize="{StaticResource SmallFontSize}"
                                                           Text="{Binding PublishedAt}" />
                                            </Grid>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </DataTemplate>
                    </husk:LazyContainer.SourceTemplate>
                </husk:LazyContainer>
            </Grid>

            <!-- Footer -->
            <Grid Grid.Row="2" ColumnDefinitions="*,Auto" ColumnSpacing="12">
                <Button Grid.Column="0" Content="{x:Static lang:Resources.Dialog_DismissButtonText}" IsCancel="True"
                        Command="{Binding $parent[modals:InstancePackageDependencyModal].Dismiss}" />
                <Button Grid.Column="1" Classes="Primary"
                        Command="{Binding $parent[modals:InstancePackageDependencyModal].InstallCommand}">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <fi:SymbolIcon Symbol="Add" FontSize="{StaticResource MediumFontSize}" />
                        <TextBlock Text="{x:Static lang:Resources.ExhibitPackageModal_AddButtonText}" />
                    </StackPanel>
                </Button>
            </Grid>
        </Grid>
    </husk:ConstrainedBox>
</husk:Modal>
