<husk:Modal xmlns="https://github.com/avaloniaui"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
            xmlns:modals="clr-namespace:Polymerium.App.Modals"
            xmlns:fi="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
            xmlns:lang="https://github.com/d3ara1n/Polymerium/Languages"
            Width="520"
            BorderThickness="0,4,0,0"
            Padding="0"
            BorderBrush="{StaticResource ControlDangerBorderBrush}"
            mc:Ignorable="d"
            x:Class="Polymerium.App.Modals.GameCrashReportModal">
    <DockPanel>
        <!-- Action Buttons at Bottom -->
        <StackPanel DockPanel.Dock="Bottom">
            <husk:Divider
                Margin="{Binding Source={StaticResource ModalContentMargin},Converter={x:Static husk:ThicknessConverters.Horizontal}}" />
            <Grid ColumnDefinitions="*,*"
                  ColumnSpacing="8" Margin="{StaticResource ModalContentMargin}">
                <!-- Export Diagnostic Package Button -->
                <Button Grid.Column="0" Classes="Primary" HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Command="{Binding $parent[modals:GameCrashReportModal].ExportDiagnosticPackageCommand}">
                    <husk:IconLabel Icon="BoxMultiple"
                                    Text="{x:Static lang:Resources.GameCrashReportModal_ExportDiagnosticPackageButtonText}" />
                </Button>
                <!-- Close Button -->
                <Button Grid.Column="1" HorizontalAlignment="Stretch" HorizontalContentAlignment="Center"
                        Command="{Binding $parent[modals:GameCrashReportModal].Dismiss}">
                    <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_CloseButtonText}" />
                </Button>
            </Grid>
        </StackPanel>

        <ScrollViewer>
            <StackPanel Margin="{StaticResource ModalContentMargin}" Spacing="20">
                <!-- Header Section - Centered -->
                <StackPanel Spacing="8" HorizontalAlignment="Center">
                    <!-- Report Type Label -->
                    <Border Background="{StaticResource ControlTranslucentHalfBackgroundBrush}"
                            CornerRadius="{StaticResource SmallCornerRadius}"
                            Padding="16,6" HorizontalAlignment="Center">
                        <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_Title}"
                                   FontSize="{StaticResource SmallFontSize}"
                                   Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                   FontWeight="{StaticResource ControlStrongFontWeight}"
                                   LetterSpacing="2" />
                    </Border>

                    <!-- Title -->
                    <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_Subtitle}"
                               FontWeight="{StaticResource ControlStrongFontWeight}"
                               FontSize="{StaticResource ExtraLargeFontSize}"
                               HorizontalAlignment="Center" Foreground="{StaticResource ControlDangerForegroundBrush}" />

                    <!-- Subtitle / Divider -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                        <Rectangle Width="20" Height="1" Fill="{StaticResource ControlSecondaryForegroundBrush}"
                                   VerticalAlignment="Center" />
                        <TextBlock
                            Text="{Binding $parent[modals:GameCrashReportModal].Report.InstanceName,FallbackValue=Instance}"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                            FontSize="{StaticResource SmallFontSize}"
                            LetterSpacing="1" />
                        <Rectangle Width="20" Height="1" Fill="{StaticResource ControlSecondaryForegroundBrush}"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Error Message -->
                    <TextBlock
                        Text="{Binding $parent[modals:GameCrashReportModal].Report.ExceptionMessage,FallbackValue={x:Null}}"
                        FontSize="{StaticResource LargeFontSize}"
                        FontWeight="{StaticResource ControlStrongFontWeight}"
                        TextWrapping="Wrap"
                        TextAlignment="Center"
                        HorizontalAlignment="Center" />
                </StackPanel>

                <!-- Key Information Cards - 2 Column Grid -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto" ColumnSpacing="12" RowSpacing="12">
                    <!-- Exit Code Card -->
                    <Border Grid.Row="0" Grid.Column="0"
                            Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                            BorderBrush="{StaticResource ControlBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="{StaticResource MediumCornerRadius}"
                            Padding="16,12">
                        <StackPanel>
                            <husk:IconLabel Icon="Warning"
                                            Text="{x:Static lang:Resources.GameCrashReportModal_ExitCodeLabelText}"
                                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                            FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.ExitCode,FallbackValue=-1}"
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Foreground="{StaticResource ControlDangerForegroundBrush}" />
                        </StackPanel>
                    </Border>

                    <!-- Play Time Card -->
                    <Border Grid.Row="0" Grid.Column="1"
                            Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                            BorderBrush="{StaticResource ControlBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="{StaticResource MediumCornerRadius}"
                            Padding="16,12">
                        <StackPanel>
                            <husk:IconLabel Icon="Clock"
                                            Text="{x:Static lang:Resources.GameCrashReportModal_PlayTimeLabelText}"
                                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                            FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.PlayTime,FallbackValue=0:00}"
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}" />
                        </StackPanel>
                    </Border>

                    <!-- Minecraft Version Card -->
                    <Border Grid.Row="1" Grid.Column="0"
                            Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                            BorderBrush="{StaticResource ControlBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="{StaticResource MediumCornerRadius}"
                            Padding="16,12">
                        <StackPanel>
                            <husk:IconLabel Icon="Games"
                                            Text="{x:Static lang:Resources.GameCrashReportModal_MinecraftVersionLabelText}"
                                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                            FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.MinecraftVersion,FallbackValue=1.0.0}"
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}" />
                        </StackPanel>
                    </Border>

                    <!-- Mod Loader Card -->
                    <Border Grid.Row="1" Grid.Column="1"
                            Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                            BorderBrush="{StaticResource ControlBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="{StaticResource MediumCornerRadius}"
                            Padding="16,12">
                        <StackPanel>
                            <husk:IconLabel Icon="AppsAddIn"
                                            Text="{x:Static lang:Resources.GameCrashReportModal_ModLoaderLabelText}"
                                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                            FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.LoaderLabel,FallbackValue=Vanilla}"
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}" />
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- System Environment Section -->
                <Border Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                        BorderBrush="{StaticResource ControlBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource MediumCornerRadius}"
                        Padding="16">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <fi:SymbolIcon Symbol="Desktop" FontSize="{StaticResource LargeFontSize}"
                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                            <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_SystemEnvironmentTitle}"
                                       FontWeight="{StaticResource ControlStrongFontWeight}" />
                        </StackPanel>
                        <Grid ColumnDefinitions="120,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto" RowSpacing="8">
                            <TextBlock Grid.Row="0" Grid.Column="0"
                                       Text="{x:Static lang:Resources.GameCrashReportModal_OperatingSystemLabelText}"
                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                       FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock Grid.Row="0" Grid.Column="1"
                                       Text="{Binding $parent[modals:GameCrashReportModal].Report.OperatingSystem,FallbackValue=Unknown}"
                                       FontSize="{StaticResource SmallFontSize}" />

                            <TextBlock Grid.Row="1" Grid.Column="0"
                                       Text="{x:Static lang:Resources.GameCrashReportModal_InstalledMemoryLabelText}"
                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                       FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock Grid.Row="1" Grid.Column="1"
                                       Text="{Binding $parent[modals:GameCrashReportModal].Report.InstalledMemory,FallbackValue=0 MB}"
                                       FontSize="{StaticResource SmallFontSize}" />

                            <TextBlock Grid.Row="2" Grid.Column="0"
                                       Text="{x:Static lang:Resources.GameCrashReportModal_AllocatedMemoryLabelText}"
                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                       FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock Grid.Row="2" Grid.Column="1"
                                       Text="{Binding $parent[modals:GameCrashReportModal].Report.AllocatedMemory,FallbackValue=0 MB}"
                                       FontSize="{StaticResource SmallFontSize}" />

                            <TextBlock Grid.Row="3" Grid.Column="0"
                                       Text="{x:Static lang:Resources.GameCrashReportModal_JavaVersionLabelText}"
                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                       FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock Grid.Row="3" Grid.Column="1"
                                       Text="{Binding $parent[modals:GameCrashReportModal].Report.JavaVersion,FallbackValue=Unknown}"
                                       FontSize="{StaticResource SmallFontSize}" />

                            <TextBlock Grid.Row="4" Grid.Column="0"
                                       Text="{x:Static lang:Resources.GameCrashReportModal_JavaPathLabelText}"
                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                       FontSize="{StaticResource SmallFontSize}" />
                            <TextBlock Grid.Row="4" Grid.Column="1"
                                       Text="{Binding $parent[modals:GameCrashReportModal].Report.JavaPath,FallbackValue=Unknown}"
                                       TextWrapping="Wrap"
                                       FontSize="{StaticResource SmallFontSize}" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Last Log Lines (if available) -->
                <Border Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                        BorderBrush="{StaticResource ControlBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource MediumCornerRadius}"
                        IsVisible="{Binding $parent[modals:GameCrashReportModal].Report.LastLogLines, Converter={x:Static ObjectConverters.IsNotNull},FallbackValue={x:False}}">
                    <StackPanel Spacing="12">
                        <StackPanel Orientation="Horizontal" Spacing="8" Margin="16,16,16,0">
                            <fi:SymbolIcon Symbol="Document" FontSize="{StaticResource LargeFontSize}"
                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                            <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_LastLogOutputTitle}"
                                       FontWeight="{StaticResource ControlStrongFontWeight}" />
                        </StackPanel>
                        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                      MaxHeight="240">
                            <TextBlock
                                Margin="16"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.LastLogLines,FallbackValue={x:Null}}"
                                FontFamily="Cascadia Code, Consolas, Courier New, monospace"
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                TextWrapping="NoWrap" />
                        </ScrollViewer>
                    </StackPanel>
                </Border>

                <!-- Quick Actions - 2 Column Grid -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="8" RowSpacing="8">
                    <Button Grid.Row="0" Grid.Column="0" HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Command="{Binding $parent[modals:GameCrashReportModal].OpenLogFileCommand}"
                            IsEnabled="{Binding $parent[modals:GameCrashReportModal].Report.LogFilePath, Converter={x:Static ObjectConverters.IsNotNull},FallbackValue={x:False}}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <fi:SymbolIcon Symbol="Document" FontSize="16" />
                            <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_OpenLatestLogButtonText}"
                                       FontSize="{StaticResource SmallFontSize}" />
                        </StackPanel>
                    </Button>
                    <Button Grid.Row="0" Grid.Column="1" HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Command="{Binding $parent[modals:GameCrashReportModal].OpenCrashReportCommand}"
                            IsEnabled="{Binding $parent[modals:GameCrashReportModal].Report.CrashReportPath, Converter={x:Static ObjectConverters.IsNotNull},FallbackValue={x:False}}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <fi:SymbolIcon Symbol="DocumentError" FontSize="16" />
                            <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_OpenCrashReportButtonText}"
                                       FontSize="{StaticResource SmallFontSize}" />
                        </StackPanel>
                    </Button>
                    <Button Grid.Row="1" Grid.Column="0" HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Command="{Binding $parent[modals:GameCrashReportModal].OpenGameDirectoryCommand}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <fi:SymbolIcon Symbol="Folder" FontSize="16" />
                            <TextBlock
                                Text="{x:Static lang:Resources.GameCrashReportModal_OpenGameDirectoryButtonText}"
                                FontSize="{StaticResource SmallFontSize}" />
                        </StackPanel>
                    </Button>
                    <Button Grid.Row="1" Grid.Column="1" HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Command="{Binding $parent[modals:GameCrashReportModal].CopyToClipboardCommand}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <fi:SymbolIcon Symbol="Copy" FontSize="16" />
                            <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_CopyReportButtonText}"
                                       FontSize="{StaticResource SmallFontSize}" />
                        </StackPanel>
                    </Button>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</husk:Modal>
