<husk:Modal
    x:Class="Polymerium.App.Modals.GameCrashReportModal"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fi="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
    xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
    xmlns:lang="https://github.com/d3ara1n/Polymerium/Languages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:modals="clr-namespace:Polymerium.App.Modals"
    Width="520"
    Padding="0"
    BorderBrush="{StaticResource ControlDangerBorderBrush}"
    BorderThickness="0,4,0,0"
    mc:Ignorable="d">
    <DockPanel>
        <!--  Action Buttons at Bottom  -->
        <StackPanel DockPanel.Dock="Bottom">
            <husk:Divider Margin="{Binding Source={StaticResource ModalContentMargin}, Converter={x:Static husk:ThicknessConverters.Horizontal}}" />
            <Grid
                Margin="{StaticResource ModalContentMargin}"
                ColumnDefinitions="*,*"
                ColumnSpacing="8">
                <!--  Export Diagnostic Package Button  -->
                <Button
                    Classes="Primary"
                    Grid.Column="0"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Command="{Binding $parent[modals:GameCrashReportModal].ExportDiagnosticPackageCommand}">
                    <husk:IconLabel
                        Icon="BoxMultiple"
                        Text="{x:Static lang:Resources.GameCrashReportModal_ExportDiagnosticPackageButtonText}" />
                </Button>
                <!--  Close Button  -->
                <Button
                    Grid.Column="1"
                    HorizontalAlignment="Stretch"
                    HorizontalContentAlignment="Center"
                    Command="{Binding $parent[modals:GameCrashReportModal].Dismiss}">
                    <TextBlock Text="{x:Static lang:Resources.GameCrashReportModal_CloseButtonText}" />
                </Button>
            </Grid>
        </StackPanel>

        <ScrollViewer>
            <StackPanel
                Margin="{StaticResource ModalContentMargin}"
                Spacing="20">
                <!--  Header Section - Centered  -->
                <StackPanel
                    HorizontalAlignment="Center"
                    Spacing="8">
                    <!--  Report Type Label  -->
                    <Border
                        Padding="16,6"
                        HorizontalAlignment="Center"
                        Background="{StaticResource ControlTranslucentHalfBackgroundBrush}"
                        CornerRadius="{StaticResource SmallCornerRadius}">
                        <TextBlock
                            FontSize="{StaticResource SmallFontSize}"
                            FontWeight="{StaticResource ControlStrongFontWeight}"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                            LetterSpacing="2"
                            Text="{x:Static lang:Resources.GameCrashReportModal_Title}" />
                    </Border>

                    <!--  Title  -->
                    <TextBlock
                        HorizontalAlignment="Center"
                        FontSize="{StaticResource ExtraLargeFontSize}"
                        FontWeight="{StaticResource ControlStrongFontWeight}"
                        Foreground="{StaticResource ControlDangerForegroundBrush}"
                        Text="{x:Static lang:Resources.GameCrashReportModal_Subtitle}" />

                    <!--  Subtitle / Divider  -->
                    <StackPanel
                        HorizontalAlignment="Center"
                        Orientation="Horizontal"
                        Spacing="12">
                        <Rectangle
                            Width="20"
                            Height="1"
                            VerticalAlignment="Center"
                            Fill="{StaticResource ControlSecondaryForegroundBrush}" />
                        <TextBlock
                            FontSize="{StaticResource SmallFontSize}"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                            LetterSpacing="1"
                            Text="{Binding $parent[modals:GameCrashReportModal].Report.InstanceName, FallbackValue=Instance}" />
                        <Rectangle
                            Width="20"
                            Height="1"
                            VerticalAlignment="Center"
                            Fill="{StaticResource ControlSecondaryForegroundBrush}" />
                    </StackPanel>

                    <!--  Error Message  -->
                    <TextBlock
                        HorizontalAlignment="Center"
                        FontSize="{StaticResource LargeFontSize}"
                        FontWeight="{StaticResource ControlStrongFontWeight}"
                        Text="{Binding $parent[modals:GameCrashReportModal].Report.ExceptionMessage, FallbackValue={x:Null}}"
                        TextAlignment="Center"
                        TextWrapping="Wrap" />
                </StackPanel>

                <!--  Key Information Cards - 2 Column Grid  -->
                <Grid
                    ColumnDefinitions="*,*"
                    ColumnSpacing="12"
                    RowDefinitions="Auto,Auto,Auto"
                    RowSpacing="12">
                    <!--  Exit Code Card  -->
                    <Border
                        Grid.Row="0"
                        Grid.Column="0"
                        Padding="16,12"
                        Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                        BorderBrush="{StaticResource ControlBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource MediumCornerRadius}">
                        <StackPanel>
                            <husk:IconLabel
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Icon="Warning"
                                Text="{x:Static lang:Resources.GameCrashReportModal_ExitCodeLabelText}" />
                            <TextBlock
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Foreground="{StaticResource ControlDangerForegroundBrush}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.ExitCode, FallbackValue=-1}" />
                        </StackPanel>
                    </Border>

                    <!--  Play Time Card  -->
                    <Border
                        Grid.Row="0"
                        Grid.Column="1"
                        Padding="16,12"
                        Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                        BorderBrush="{StaticResource ControlBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource MediumCornerRadius}">
                        <StackPanel>
                            <husk:IconLabel
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Icon="Clock"
                                Text="{x:Static lang:Resources.GameCrashReportModal_PlayTimeLabelText}" />
                            <TextBlock
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.PlayTime, FallbackValue=0:00}" />
                        </StackPanel>
                    </Border>

                    <!--  Minecraft Version Card  -->
                    <Border
                        Grid.Row="1"
                        Grid.Column="0"
                        Padding="16,12"
                        Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                        BorderBrush="{StaticResource ControlBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource MediumCornerRadius}">
                        <StackPanel>
                            <husk:IconLabel
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Icon="Games"
                                Text="{x:Static lang:Resources.GameCrashReportModal_MinecraftVersionLabelText}" />
                            <TextBlock
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.MinecraftVersion, FallbackValue=1.0.0}" />
                        </StackPanel>
                    </Border>

                    <!--  Mod Loader Card  -->
                    <Border
                        Grid.Row="1"
                        Grid.Column="1"
                        Padding="16,12"
                        Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                        BorderBrush="{StaticResource ControlBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="{StaticResource MediumCornerRadius}">
                        <StackPanel>
                            <husk:IconLabel
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Icon="AppsAddIn"
                                Text="{x:Static lang:Resources.GameCrashReportModal_ModLoaderLabelText}" />
                            <TextBlock
                                FontSize="{StaticResource LargeFontSize}"
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.LoaderLabel, FallbackValue=Vanilla}" />
                        </StackPanel>
                    </Border>
                </Grid>

                <!--  System Environment Section  -->
                <Border
                    Padding="16"
                    Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                    BorderBrush="{StaticResource ControlBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource MediumCornerRadius}">
                    <StackPanel Spacing="12">
                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="8">
                            <fi:SymbolIcon
                                FontSize="{StaticResource LargeFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Symbol="Desktop" />
                            <TextBlock
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_SystemEnvironmentTitle}" />
                        </StackPanel>
                        <Grid
                            ColumnDefinitions="120,*"
                            RowDefinitions="Auto,Auto,Auto,Auto,Auto"
                            RowSpacing="8">
                            <TextBlock
                                Grid.Row="0"
                                Grid.Column="0"
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_OperatingSystemLabelText}" />
                            <TextBlock
                                Grid.Row="0"
                                Grid.Column="1"
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.OperatingSystem, FallbackValue=Unknown}" />

                            <TextBlock
                                Grid.Row="1"
                                Grid.Column="0"
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_InstalledMemoryLabelText}" />
                            <TextBlock
                                Grid.Row="1"
                                Grid.Column="1"
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.InstalledMemory, FallbackValue=0 MB}" />

                            <TextBlock
                                Grid.Row="2"
                                Grid.Column="0"
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_AllocatedMemoryLabelText}" />
                            <TextBlock
                                Grid.Row="2"
                                Grid.Column="1"
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.AllocatedMemory, FallbackValue=0 MB}" />

                            <TextBlock
                                Grid.Row="3"
                                Grid.Column="0"
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_JavaVersionLabelText}" />
                            <TextBlock
                                Grid.Row="3"
                                Grid.Column="1"
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.JavaVersion, FallbackValue=Unknown}" />

                            <TextBlock
                                Grid.Row="4"
                                Grid.Column="0"
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_JavaPathLabelText}" />
                            <TextBlock
                                Grid.Row="4"
                                Grid.Column="1"
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.JavaPath, FallbackValue=Unknown}"
                                TextWrapping="Wrap" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!--  Last Log Lines (if available)  -->
                <Border
                    IsVisible="{Binding $parent[modals:GameCrashReportModal].Report.LastLogLines, Converter={x:Static ObjectConverters.IsNotNull}, FallbackValue={x:False}}"
                    Background="{StaticResource ControlTranslucentFullBackgroundBrush}"
                    BorderBrush="{StaticResource ControlBorderBrush}"
                    BorderThickness="1"
                    CornerRadius="{StaticResource MediumCornerRadius}">
                    <StackPanel Spacing="12">
                        <StackPanel
                            Margin="16,16,16,0"
                            Orientation="Horizontal"
                            Spacing="8">
                            <fi:SymbolIcon
                                FontSize="{StaticResource LargeFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Symbol="Document" />
                            <TextBlock
                                FontWeight="{StaticResource ControlStrongFontWeight}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_LastLogOutputTitle}" />
                        </StackPanel>
                        <ScrollViewer
                            MaxHeight="240"
                            HorizontalScrollBarVisibility="Auto">
                            <TextBlock
                                Margin="16"
                                FontFamily="Cascadia Code, Consolas, Courier New, monospace"
                                FontSize="{StaticResource SmallFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="{Binding $parent[modals:GameCrashReportModal].Report.LastLogLines, FallbackValue={x:Null}}"
                                TextWrapping="NoWrap" />
                        </ScrollViewer>
                    </StackPanel>
                </Border>

                <!--  Quick Actions - 2 Column Grid  -->
                <Grid
                    ColumnDefinitions="*,*"
                    ColumnSpacing="8"
                    RowDefinitions="Auto,Auto"
                    RowSpacing="8">
                    <Button
                        Grid.Row="0"
                        Grid.Column="0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        IsEnabled="{Binding $parent[modals:GameCrashReportModal].Report.LogFilePath, Converter={x:Static ObjectConverters.IsNotNull}, FallbackValue={x:False}}"
                        Command="{Binding $parent[modals:GameCrashReportModal].OpenLogFileCommand}">
                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="8">
                            <fi:SymbolIcon
                                FontSize="16"
                                Symbol="Document" />
                            <TextBlock
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_OpenLatestLogButtonText}" />
                        </StackPanel>
                    </Button>
                    <Button
                        Grid.Row="0"
                        Grid.Column="1"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        IsEnabled="{Binding $parent[modals:GameCrashReportModal].Report.CrashReportPath, Converter={x:Static ObjectConverters.IsNotNull}, FallbackValue={x:False}}"
                        Command="{Binding $parent[modals:GameCrashReportModal].OpenCrashReportCommand}">
                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="8">
                            <fi:SymbolIcon
                                FontSize="16"
                                Symbol="DocumentError" />
                            <TextBlock
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_OpenCrashReportButtonText}" />
                        </StackPanel>
                    </Button>
                    <Button
                        Grid.Row="1"
                        Grid.Column="0"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Command="{Binding $parent[modals:GameCrashReportModal].OpenGameDirectoryCommand}">
                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="8">
                            <fi:SymbolIcon
                                FontSize="16"
                                Symbol="Folder" />
                            <TextBlock
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_OpenGameDirectoryButtonText}" />
                        </StackPanel>
                    </Button>
                    <Button
                        Grid.Row="1"
                        Grid.Column="1"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        Command="{Binding $parent[modals:GameCrashReportModal].CopyToClipboardCommand}">
                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="8">
                            <fi:SymbolIcon
                                FontSize="16"
                                Symbol="Copy" />
                            <TextBlock
                                FontSize="{StaticResource SmallFontSize}"
                                Text="{x:Static lang:Resources.GameCrashReportModal_CopyReportButtonText}" />
                        </StackPanel>
                    </Button>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</husk:Modal>
