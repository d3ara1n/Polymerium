<husk:Modal xmlns="https://github.com/avaloniaui"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
            xmlns:m="clr-namespace:Polymerium.App.Models"
            xmlns:fi="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
            xmlns:huskc="https://github.com/d3ara1n/Huskui.Avalonia/Converters"
            xmlns:modals="clr-namespace:Polymerium.App.Modals"
            xmlns:trident="clr-namespace:Trident.Abstractions.Repositories.Resources;assembly=Trident.Abstractions"
            xmlns:async="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
            xmlns:icons="https://github.com/MahApps/IconPacks.Avalonia"
            mc:Ignorable="d" d:DesignWidth="720" d:DesignHeight="420" MinHeight="360"
            x:Class="Polymerium.App.Modals.ExhibitPackageModal" x:DataType="m:ExhibitPackageModel"
            Background="{x:Null}" BorderBrush="{x:Null}"
            BorderThickness="0" Padding="0" CornerRadius="0" Margin="0,65">
    <husk:ConstrainedBox AspectRatio="1.4">
        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
            <Border Grid.Column="1" Padding="18" Width="280"
                    Background="{StaticResource OverlaySolidBackgroundBrush}"
                    BorderBrush="{StaticResource ControlBorderBrush}" BorderThickness="1"
                    CornerRadius="{StaticResource MediumCornerRadius}">
                <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" RowSpacing="12">
                    <Grid Row="0" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Border Grid.Column="0" Height="48" Width="48"
                                CornerRadius="{StaticResource SmallCornerRadius}">
                            <Border.Background>
                                <ImageBrush async:ImageBrushLoader.Source="{Binding Thumbnail}" />
                            </Border.Background>
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="4">
                            <TextBlock Text="{Binding ProjectName,FallbackValue=Package}"
                                       TextTrimming="CharacterEllipsis"
                                       FontSize="{StaticResource LargeFontSize}" FontWeight="Bold" />
                            <HyperlinkButton NavigateUri="{Binding ReferenceUrl}">
                                <ToolTip.Tip>
                                    <StackPanel Margin="10,6" Spacing="2">
                                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="4">
                                            <TextBlock Grid.Column="0" Text="EXTERNAL LINK TO"
                                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                            <fi:SymbolIcon Grid.Column="1" Symbol="Open"
                                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                           FontSize="{StaticResource MediumFontSize}" />
                                        </Grid>
                                        <TextBlock
                                            Text="{Binding $parent[HyperlinkButton].NavigateUri}" />
                                    </StackPanel>
                                </ToolTip.Tip>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock
                                        Text="{Binding ReferenceLabel,FallbackValue=Label,Converter={x:Static huskc:StringConverters.ToUpper}}" />
                                    <fi:SymbolIcon Symbol="Open" FontSize="12" />
                                </StackPanel>
                            </HyperlinkButton>
                        </StackPanel>
                        <Grid Grid.Column="2" RowDefinitions="*,*" RowSpacing="4">
                            <Button Grid.Row="0" Theme="{StaticResource OutlineButtonTheme}" Classes="Small"
                                    Click="DismissButton_OnClick">
                                <fi:SymbolIcon Symbol="Dismiss" FontSize="{StaticResource MediumFontSize}" />
                            </Button>
                            <!-- <ToggleButton Grid.Row="1"  Classes="Small"> -->
                            <!--     <fi:SymbolIcon Symbol="MoreHorizontal" FontSize="{StaticResource MediumFontSize}" /> -->
                            <!-- </ToggleButton> -->
                        </Grid>
                    </Grid>
                    <ItemsControl Grid.Row="1" ItemsSource="{Binding Tags}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <husk:Tag Content="{Binding}" FontSize="{StaticResource MediumFontSize}" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel ItemSpacing="4" LineSpacing="4" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                    </ItemsControl>
                    <TextBlock Grid.Row="2"
                               Text="{Binding Summary,FallbackValue=Summary}"
                               TextWrapping="Wrap" TextTrimming="CharacterEllipsis" />
                    <StackPanel Grid.Row="3" Spacing="4">
                        <CheckBox IsChecked="{Binding $parent[modals:ExhibitPackageModal].IsFilterEnabled,Mode=TwoWay}">
                            <TextBlock Text="Show compatible versions only" />
                        </CheckBox>
                        <TabStrip
                            SelectedIndex="{Binding $parent[modals:ExhibitPackageModal].SelectedVersionMode,Mode=TwoWay}">
                            <TabStrip.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8" />
                                </ItemsPanelTemplate>
                            </TabStrip.ItemsPanel>
                            <TabStripItem Grid.Column="0" Padding="0">
                                <husk:LazyContainer
                                    LazySource="{Binding $parent[modals:ExhibitPackageModal].LazyVersions,Mode=OneWay}"
                                    CornerRadius="{StaticResource SmallCornerRadius}">
                                    <husk:LazyContainer.ContentTemplate>
                                        <DataTemplate DataType="m:ExhibitVersionCollection">
                                            <ComboBox Theme="{StaticResource GhostComboBoxTheme}"
                                                      SelectedItem="{Binding $parent[modals:ExhibitPackageModal].SelectedVersion,Mode=TwoWay,FallbackValue={x:Null}}"
                                                      ItemsSource="{Binding}"
                                                      PlaceholderText="Specific version..." VerticalAlignment="Stretch"
                                                      VerticalContentAlignment="Center">
                                                <ComboBox.SelectionBoxItemTemplate>
                                                    <DataTemplate DataType="m:ExhibitVersionModel">
                                                        <StackPanel>
                                                            <TextBlock Text="Version:"
                                                                       FontSize="{StaticResource SmallFontSize}"
                                                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                            <TextBlock Text="{Binding VersionName}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.SelectionBoxItemTemplate>
                                                <ComboBox.ItemTemplate>
                                                    <DataTemplate DataType="m:ExhibitVersionModel">
                                                        <StackPanel Spacing="4">
                                                            <TextBlock
                                                                Text="{Binding VersionName,FallbackValue=Display}" />
                                                            <DockPanel>
                                                                <StackPanel Orientation="Horizontal"
                                                                            DockPanel.Dock="Right">
                                                                    <TextBlock Text="{Binding PublishedAt}" />
                                                                </StackPanel>
                                                                <husk:SwitchPresenter TargetType="trident:ReleaseType"
                                                                    Value="{Binding TypeRaw,FallbackValue=Release}">
                                                                    <husk:SwitchCase Value="Release">
                                                                        <husk:Tag Classes="Success"
                                                                            CornerRadius="{StaticResource SmallCornerRadius}">
                                                                            <TextBlock Text="Release" />
                                                                        </husk:Tag>
                                                                    </husk:SwitchCase>
                                                                    <husk:SwitchCase Value="Beta">
                                                                        <husk:Tag Classes="Warning"
                                                                            CornerRadius="{StaticResource SmallCornerRadius}">
                                                                            <TextBlock Text="Beta" />
                                                                        </husk:Tag>
                                                                    </husk:SwitchCase>
                                                                    <husk:SwitchCase Value="Alpha">
                                                                        <husk:Tag Classes="Danger"
                                                                            CornerRadius="{StaticResource SmallCornerRadius}">
                                                                            <TextBlock Text="Alpha" />
                                                                        </husk:Tag>
                                                                    </husk:SwitchCase>
                                                                </husk:SwitchPresenter>
                                                            </DockPanel>
                                                            <Grid ColumnDefinitions="Auto,Auto,Auto,*"
                                                                  ColumnSpacing="4">
                                                                <fi:SymbolIcon Grid.Column="0" Symbol="Flag"
                                                                               FontSize="{StaticResource MediumFontSize}"
                                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                                <TextBlock Grid.Column="1"
                                                                           Text="{Binding CompatibleLoaders}"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                                <fi:SymbolIcon Grid.Column="2" Symbol="Branch"
                                                                               FontSize="{StaticResource MediumFontSize}"
                                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                                <TextBlock Grid.Column="3"
                                                                           Text="{Binding CompatibleVersions}"
                                                                           TextTrimming="CharacterEllipsis"
                                                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                            </Grid>
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ComboBox.ItemTemplate>
                                            </ComboBox>
                                        </DataTemplate>
                                    </husk:LazyContainer.ContentTemplate>
                                </husk:LazyContainer>
                            </TabStripItem>
                            <TabStripItem Grid.Column="1">
                                <StackPanel>
                                    <fi:SymbolIcon Symbol="BoxCheckmark" FontSize="{StaticResource LargeFontSize}" />
                                    <TextBlock Text="Auto" />
                                </StackPanel>
                            </TabStripItem>
                        </TabStrip>
                    </StackPanel>
                    <Grid Grid.Row="4" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                        <Button Grid.Column="0" Theme="{StaticResource OutlineButtonTheme}">
                            <fi:SymbolIcon Symbol="Bookmark" FontSize="{StaticResource MediumFontSize}" />
                        </Button>
                        <Button Grid.Column="1" Classes="Primary">
                            <StackPanel Orientation="Horizontal" Spacing="12">
                                <fi:SymbolIcon Symbol="Add" FontSize="{StaticResource MediumFontSize}" />
                                <TextBlock Text="Add to the instance" />
                            </StackPanel>
                        </Button>
                    </Grid>
                </Grid>
            </Border>
            <Border Grid.Column="0" Padding="{StaticResource ModalContentMargin}"
                    Background="{StaticResource OverlaySolidBackgroundBrush}"
                    BorderBrush="{StaticResource ControlBorderBrush}" BorderThickness="1"
                    CornerRadius="{StaticResource MediumCornerRadius}">
                <TabControl Theme="{StaticResource SolidTabControlTheme}">
                    <TabControl.ItemContainerTheme>
                        <ControlTheme TargetType="TabItem" BasedOn="{StaticResource SolidTabItemTheme}">
                            <Setter Property="FontSize" Value="{StaticResource MediumFontSize}" />
                        </ControlTheme>
                    </TabControl.ItemContainerTheme>
                    <TabItem ToolTip.Tip="About">
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                                <icons:PackIconLucide Kind="House" Height="{StaticResource MediumFontSize}"
                                                      Width="{StaticResource MediumFontSize}"
                                                      VerticalAlignment="Center" />
                                <!-- <TextBlock Text="About" VerticalAlignment="Center" /> -->
                            </StackPanel>
                        </TabItem.Header>
                    </TabItem>
                    <TabItem ToolTip.Tip="Dependencies">
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                                <icons:PackIconLucide Kind="List" Height="{StaticResource MediumFontSize}"
                                                      Width="{StaticResource MediumFontSize}"
                                                      VerticalAlignment="Center" />
                                <TextBlock Text="Dependencies" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabItem.Header>
                    </TabItem>
                    <TabItem ToolTip.Tip="Changelogs">
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Top">
                                <icons:PackIconLucide Kind="FileText" Height="{StaticResource MediumFontSize}"
                                                      Width="{StaticResource MediumFontSize}"
                                                      VerticalAlignment="Center" />
                                <TextBlock Text="Changelogs" VerticalAlignment="Center" />
                            </StackPanel>
                        </TabItem.Header>
                    </TabItem>

                </TabControl>
            </Border>
        </Grid>
    </husk:ConstrainedBox>
</husk:Modal>