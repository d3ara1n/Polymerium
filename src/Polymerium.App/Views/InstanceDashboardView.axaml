<controls:Subpage
    x:Class="Polymerium.App.Views.InstanceDashboardView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Polymerium.App.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:fi="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
    xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
    xmlns:icons="https://github.com/MahApps/IconPacks.Avalonia"
    xmlns:lang="https://github.com/d3ara1n/Polymerium/Languages"
    xmlns:launching="clr-namespace:Trident.Core.Engines.Launching;assembly=Trident.Core"
    xmlns:m="clr-namespace:Polymerium.App.Models"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:trident="using:Trident.Core"
    xmlns:vm="clr-namespace:Polymerium.App.ViewModels"
    d:DesignHeight="600"
    d:DesignWidth="800"
    x:DataType="vm:InstanceDashboardViewModel"
    ScrollViewer.VerticalScrollBarVisibility="Disabled"
    mc:Ignorable="d">
    <controls:Subpage.Resources>
        <husk:RelayDataTemplate
            x:Key="LogSourceTemplate"
            x:DataType="m:LogSourceModelBase">
            <DataTemplate DataType="m:LiveLogSourceModel">
                <Grid
                    ColumnDefinitions="Auto,*,Auto"
                    ColumnSpacing="8">
                    <icons:PackIconLucide
                        Grid.Column="0"
                        Width="{StaticResource MediumFontSize}"
                        Height="{StaticResource MediumFontSize}"
                        VerticalAlignment="Center"
                        Kind="Radio" />
                    <TextBlock
                        Grid.Column="1"
                        Text="实时日志" />
                    <husk:Tag
                        Classes="Small Success"
                        Grid.Column="2"
                        Content="Live" />
                </Grid>
            </DataTemplate>
            <DataTemplate DataType="m:FileLogSourceModel">
                <Grid
                    ColumnDefinitions="Auto,*"
                    ColumnSpacing="8">
                    <icons:PackIconLucide
                        Grid.Column="0"
                        Width="{StaticResource MediumFontSize}"
                        Height="{StaticResource MediumFontSize}"
                        VerticalAlignment="Center"
                        Kind="File" />
                    <TextBlock
                        Grid.Column="1"
                        Text="{Binding Name}" />
                </Grid>
            </DataTemplate>
        </husk:RelayDataTemplate>
        <!--  日志条目内容模板  -->
        <DataTemplate
            x:Key="ScrapTemplate"
            DataType="m:ScrapModel">
            <TextBlock
                TextTrimming="CharacterEllipsis"
                ToolTip.Tip="{Binding Message}">
                <Run
                    FontFamily="Cascadia Code, Consolas, monospace"
                    Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                    Text="{Binding Time, StringFormat=HH:mm:ss}" />
                <InlineUIContainer BaselineAlignment="Center">
                    <Border
                        Padding="4,2"
                        Background="{StaticResource ControlTranslucentHalfBackgroundBrush}"
                        CornerRadius="2">
                        <Border.IsVisible>
                            <MultiBinding Converter="{x:Static BoolConverters.Or}">
                                <Binding
                                    Converter="{x:Static StringConverters.IsNotNullOrEmpty}"
                                    Path="Thread" />
                                <Binding
                                    Converter="{x:Static StringConverters.IsNotNullOrEmpty}"
                                    Path="Sender" />
                            </MultiBinding>
                        </Border.IsVisible>
                        <TextBlock
                            FontFamily="Cascadia Code, Consolas, monospace"
                            FontSize="{StaticResource ExtraSmallFontSize}"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}">
                            <Run Text="[" />
                            <Run Text="{Binding Thread, FallbackValue=?}" />
                            <Run Text="/" />
                            <Run Text="{Binding Sender, FallbackValue=?}" />
                            <Run Text="]" />
                        </TextBlock>
                    </Border>
                </InlineUIContainer>
                <Run Text="{Binding Message}" />
            </TextBlock>
        </DataTemplate>
    </controls:Subpage.Resources>

    <Grid
        RowDefinitions="Auto,*"
        RowSpacing="12">
        <!--  顶部统计卡片区域  -->
        <UniformGrid
            Grid.Row="0"
            HorizontalAlignment="Stretch"
            ColumnSpacing="12"
            Columns="4"
            Rows="1">
            <!--  运行状态卡片  -->
            <husk:Card Padding="0">
                <husk:SwitchPresenter
                    TargetType="trident:InstanceState"
                    Value="{Binding State}">
                    <!--  Running 状态  -->
                    <husk:SwitchCase Value="Running">
                        <Border
                            Padding="12"
                            Background="{StaticResource ControlAccentTranslucentHalfBackgroundBrush}"
                            CornerRadius="{StaticResource SmallCornerRadius}">
                            <StackPanel
                                VerticalAlignment="Center"
                                Spacing="8">
                                <icons:PackIconLucide
                                    Width="32"
                                    Height="32"
                                    HorizontalAlignment="Center"
                                    Foreground="{StaticResource ControlAccentForegroundBrush}"
                                    Kind="Play" />
                                <TextBlock
                                    HorizontalAlignment="Center"
                                    FontSize="{StaticResource LargeFontSize}"
                                    FontWeight="{StaticResource ControlStrongFontWeight}"
                                    Foreground="{StaticResource ControlAccentForegroundBrush}"
                                    Text="运行中" />
                            </StackPanel>
                        </Border>
                    </husk:SwitchCase>
                    <!--  Deploying 状态  -->
                    <husk:SwitchCase Value="Deploying">
                        <StackPanel
                            Margin="{StaticResource CardContentMargin}"
                            VerticalAlignment="Center"
                            Spacing="8">
                            <husk:ProgressRing
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                IsIndeterminate="True" />
                            <TextBlock
                                HorizontalAlignment="Center"
                                FontSize="{StaticResource LargeFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="部署中" />
                        </StackPanel>
                    </husk:SwitchCase>
                    <!--  Updating 状态  -->
                    <husk:SwitchCase Value="Updating">
                        <StackPanel
                            Margin="{StaticResource CardContentMargin}"
                            VerticalAlignment="Center"
                            Spacing="8">
                            <husk:ProgressRing
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                IsIndeterminate="True" />
                            <TextBlock
                                HorizontalAlignment="Center"
                                FontSize="{StaticResource LargeFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="更新中" />
                        </StackPanel>
                    </husk:SwitchCase>
                    <!--  Idle 状态  -->
                    <husk:SwitchCase Value="Idle">
                        <StackPanel
                            Margin="{StaticResource CardContentMargin}"
                            VerticalAlignment="Center"
                            Spacing="8">
                            <icons:PackIconLucide
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Center"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Kind="CirclePause" />
                            <TextBlock
                                HorizontalAlignment="Center"
                                FontSize="{StaticResource LargeFontSize}"
                                Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                Text="空闲" />
                        </StackPanel>
                    </husk:SwitchCase>
                </husk:SwitchPresenter>
            </husk:Card>

            <!--  游戏次数卡片  -->
            <husk:Card>
                <Grid
                    RowDefinitions="*,Auto"
                    RowSpacing="8">
                    <StackPanel
                        Grid.Row="0"
                        VerticalAlignment="Center"
                        Spacing="4">
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="{StaticResource ExtraLargeFontSize}"
                            FontWeight="{StaticResource ControlStrongFontWeight}"
                            Text="114" />
                        <TextBlock
                            HorizontalAlignment="Center"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                            Text="游戏次数" />
                    </StackPanel>
                    <Button
                        Classes="Small"
                        Grid.Row="1"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center">
                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="6">
                            <icons:PackIconLucide
                                Width="{StaticResource MediumFontSize}"
                                Height="{StaticResource MediumFontSize}"
                                Kind="FolderOpen" />
                            <TextBlock Text="日志目录" />
                        </StackPanel>
                    </Button>
                </Grid>
            </husk:Card>

            <!--  崩溃次数卡片  -->
            <husk:Card>
                <Grid
                    RowDefinitions="*,Auto"
                    RowSpacing="8">
                    <StackPanel
                        Grid.Row="0"
                        VerticalAlignment="Center"
                        Spacing="4">
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="{StaticResource ExtraLargeFontSize}"
                            FontWeight="{StaticResource ControlStrongFontWeight}"
                            Text="514" />
                        <TextBlock
                            HorizontalAlignment="Center"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                            Text="崩溃次数" />
                    </StackPanel>
                    <Button
                        Classes="Small"
                        Grid.Row="1"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center">
                        <StackPanel
                            Orientation="Horizontal"
                            Spacing="6">
                            <icons:PackIconLucide
                                Width="{StaticResource MediumFontSize}"
                                Height="{StaticResource MediumFontSize}"
                                Kind="FolderOpen" />
                            <TextBlock Text="崩溃报告" />
                        </StackPanel>
                    </Button>
                </Grid>
            </husk:Card>

            <!--  待添加卡片  -->
            <husk:Card>
                <StackPanel
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Spacing="8">
                    <icons:PackIconLucide
                        Width="32"
                        Height="32"
                        HorizontalAlignment="Center"
                        Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                        Kind="Plus" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                        Text="WIP" />
                </StackPanel>
            </husk:Card>
        </UniformGrid>

        <!--  日志查看器区域  -->
        <husk:Card
            Grid.Row="1"
            Padding="0"
            ClipToBounds="True">
            <Grid RowDefinitions="Auto,Auto,*">
                <!--  控制区域  -->
                <Grid
                    Grid.Row="0"
                    Margin="8"
                    ColumnDefinitions="Auto,*,Auto"
                    ColumnSpacing="8">
                    <!--  数据源选择  -->
                    <ComboBox
                        Grid.Column="0"
                        MinWidth="180"
                        ItemTemplate="{StaticResource LogSourceTemplate}"
                        ItemsSource="{Binding Sources}"
                        SelectedIndex="0"
                        SelectedItem="{Binding SelectedSource, Mode=TwoWay}" />

                    <!--  搜索框  -->
                    <TextBox
                        Grid.Column="1"
                        Watermark="搜索日志内容...">
                        <TextBox.InnerLeftContent>
                            <StackPanel Orientation="Horizontal">
                                <icons:PackIconLucide
                                    Width="{StaticResource MediumFontSize}"
                                    Height="{StaticResource MediumFontSize}"
                                    Margin="12,0"
                                    VerticalAlignment="Center"
                                    Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                    Kind="Search" />
                                <husk:Divider Orientation="Vertical" />
                            </StackPanel>
                        </TextBox.InnerLeftContent>
                        <TextBox.InnerRightContent>
                            <StackPanel Orientation="Horizontal">
                                <Button
                                    IsVisible="{Binding $parent[TextBox].Text, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                    Command="{Binding $parent[TextBox].Clear}">
                                    <fi:SymbolIcon
                                        FontSize="{StaticResource SmallFontSize}"
                                        Symbol="Dismiss" />
                                </Button>
                                <TextBlock
                                    Margin="0,0,8,0"
                                    VerticalAlignment="Center"
                                    Foreground="{StaticResource ControlSecondaryForegroundBrush}">
                                    <Run Text="214" />
                                    <Run Text="/" />
                                    <Run Text="214" />
                                </TextBlock>
                            </StackPanel>
                        </TextBox.InnerRightContent>
                    </TextBox>

                    <!--  日志级别过滤器  -->
                    <StackPanel
                        Grid.Column="2"
                        Orientation="Horizontal"
                        Spacing="4">
                        <!--  Error 过滤  -->
                        <ToggleButton Classes="Small">
                            <ToggleButton.Styles>
                                <Style Selector="ToggleButton:checked">
                                    <Setter Property="Background" Value="{StaticResource ControlDangerTranslucentHalfBackgroundBrush}" />
                                    <Setter Property="Foreground" Value="{StaticResource ControlDangerForegroundBrush}" />
                                </Style>
                            </ToggleButton.Styles>
                            <StackPanel
                                Orientation="Horizontal"
                                Spacing="4">
                                <Ellipse
                                    Width="{StaticResource SmallFontSize}"
                                    Height="{StaticResource SmallFontSize}"
                                    Fill="{StaticResource ControlDangerBackgroundBrush}" />
                                <TextBlock
                                    FontSize="{StaticResource SmallFontSize}"
                                    Text="8" />
                            </StackPanel>
                        </ToggleButton>

                        <!--  Warning 过滤  -->
                        <ToggleButton Classes="Small">
                            <ToggleButton.Styles>
                                <Style Selector="ToggleButton:checked">
                                    <Setter Property="Background" Value="{StaticResource ControlWarningTranslucentHalfBackgroundBrush}" />
                                    <Setter Property="Foreground" Value="{StaticResource ControlWarningForegroundBrush}" />
                                </Style>
                            </ToggleButton.Styles>
                            <StackPanel
                                Orientation="Horizontal"
                                Spacing="4">
                                <Ellipse
                                    Width="{StaticResource SmallFontSize}"
                                    Height="{StaticResource SmallFontSize}"
                                    Fill="{StaticResource ControlWarningBackgroundBrush}" />
                                <TextBlock
                                    FontSize="{StaticResource SmallFontSize}"
                                    Text="111" />
                            </StackPanel>
                        </ToggleButton>

                        <!--  Information 过滤  -->
                        <ToggleButton Classes="Small">
                            <ToggleButton.Styles>
                                <Style Selector="ToggleButton:checked">
                                    <Setter Property="Background" Value="{StaticResource ControlAccentTranslucentHalfBackgroundBrush}" />
                                    <Setter Property="Foreground" Value="{StaticResource ControlAccentForegroundBrush}" />
                                </Style>
                            </ToggleButton.Styles>
                            <StackPanel
                                Orientation="Horizontal"
                                Spacing="4">
                                <Ellipse
                                    Width="{StaticResource SmallFontSize}"
                                    Height="{StaticResource SmallFontSize}"
                                    Fill="{StaticResource ControlBackgroundBrush}" />
                                <TextBlock
                                    FontSize="{StaticResource SmallFontSize}"
                                    Text="1021" />
                            </StackPanel>
                        </ToggleButton>
                    </StackPanel>
                </Grid>

                <husk:Divider Grid.Row="1" />

                <!--  日志内容区域  -->
                <Panel Grid.Row="2">
                    <!--  空状态提示  -->
                    <StackPanel
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Spacing="8">
                        <icons:PackIconLucide
                            Width="48"
                            Height="48"
                            HorizontalAlignment="Center"
                            Kind="FileText"
                            Opacity="0.3" />
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="{StaticResource LargeFontSize}"
                            Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                            Text="{x:Static lang:Resources.Shared_EmptyListLabelText}" />
                    </StackPanel>

                    <!--  日志列表  -->
                    <ScrollViewer>
                        <ItemsControl>
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <VirtualizingStackPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="m:ScrapModel">
                                    <husk:SwitchPresenter TargetType="launching:ScrapLevel">
                                        <!--  Information 级别  -->
                                        <husk:SwitchCase Value="Information">
                                            <Border
                                                Padding="8,0"
                                                Background="{StaticResource ControlTranslucentHalfBackgroundBrush}"
                                                BorderBrush="{StaticResource ControlBorderBrush}"
                                                BorderThickness="3,0,0,0">
                                                <ContentControl
                                                    Content="{Binding}"
                                                    ContentTemplate="{StaticResource LogEntryContentTemplate}" />
                                            </Border>
                                        </husk:SwitchCase>
                                        <!--  Warning 级别  -->
                                        <husk:SwitchCase Value="Warning">
                                            <Border
                                                Padding="8,0"
                                                Background="{StaticResource ControlWarningTranslucentHalfBackgroundBrush}"
                                                BorderBrush="{StaticResource ControlWarningBorderBrush}"
                                                BorderThickness="3,0,0,0">
                                                <ContentControl
                                                    Content="{Binding}"
                                                    ContentTemplate="{StaticResource LogEntryContentTemplate}" />
                                            </Border>
                                        </husk:SwitchCase>
                                        <!--  Error 级别  -->
                                        <husk:SwitchCase Value="Error">
                                            <Border
                                                Padding="8,0"
                                                Background="{StaticResource ControlDangerTranslucentHalfBackgroundBrush}"
                                                BorderBrush="{StaticResource ControlDangerBorderBrush}"
                                                BorderThickness="3,0,0,0">
                                                <ContentControl
                                                    Content="{Binding}"
                                                    ContentTemplate="{StaticResource LogEntryContentTemplate}" />
                                            </Border>
                                        </husk:SwitchCase>
                                    </husk:SwitchPresenter>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Panel>
            </Grid>
        </husk:Card>
    </Grid>
</controls:Subpage>
