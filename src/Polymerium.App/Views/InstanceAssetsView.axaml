<controls:Subpage xmlns="https://github.com/avaloniaui"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                  xmlns:husk="https://github.com/d3ara1n/Huskui.Avalonia"
                  xmlns:controls="clr-namespace:Polymerium.App.Controls"
                  xmlns:icons="https://github.com/MahApps/IconPacks.Avalonia"
                  xmlns:vm="clr-namespace:Polymerium.App.ViewModels"
                  xmlns:m="clr-namespace:Polymerium.App.Models"
                  xmlns:v="clr-namespace:Polymerium.App.Views"
                  xmlns:lang="https://github.com/d3ara1n/Polymerium/Languages"
                  xmlns:fi="clr-namespace:FluentIcons.Avalonia;assembly=FluentIcons.Avalonia"
                  xmlns:collections="clr-namespace:System.Collections;assembly=System.Runtime"
                  xmlns:fie="clr-namespace:FluentIcons.Avalonia.MarkupExtensions;assembly=FluentIcons.Avalonia"
                  mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
                  x:Class="Polymerium.App.Views.InstanceAssetsView" x:DataType="vm:InstanceAssetsViewModel"
                  ScrollViewer.VerticalScrollBarVisibility="Disabled">
    <TabControl Padding="0">
        <TabItem>
            <TabItem.Header>
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{x:Static lang:Resources.AssetKind_Mod}" />
                    <husk:PlaceholderPresenter Source="{Binding Mods}">
                        <husk:PlaceholderPresenter.SourceTemplate>
                            <DataTemplate DataType="collections:IList">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="(" />
                                    <TextBlock
                                        Text="{Binding Count,FallbackValue=(0)}" />
                                    <TextBlock Text="+"
                                               IsVisible="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).PackageCount,Converter={x:Static husk:NumberConverters.IsNonZero},FallbackValue=False}" />
                                    <TextBlock Text=")" />
                                </StackPanel>
                            </DataTemplate>
                        </husk:PlaceholderPresenter.SourceTemplate>
                        <husk:ProgressRing
                            IsIndeterminate="{Binding Mods,Converter={x:Static ObjectConverters.IsNull}}"
                            Height="{Binding $parent[TabItem].FontSize}" Width="{Binding $parent[TabItem].FontSize}" />
                    </husk:PlaceholderPresenter>
                </StackPanel>
            </TabItem.Header>
            <Grid RowDefinitions="Auto,*" RowSpacing="12">
                <husk:InfoBar Grid.Row="0"
                              IsVisible="{Binding PackageCount,Converter={x:Static husk:NumberConverters.IsNonZero}}">
                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Border Grid.Column="0"
                                CornerRadius="{StaticResource SmallCornerRadius}"
                                VerticalAlignment="Center">
                            <icons:PackIconLucide Kind="Info"
                                                  Height="{StaticResource ExtraLargeFontSize}"
                                                  Width="{StaticResource ExtraLargeFontSize}"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center" />
                        </Border>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                            <TextBlock FontWeight="{StaticResource ControlStrongFontWeight}">
                                <Run Text="This page shows physical mod files only" />
                            </TextBlock>
                            <TextBlock FontSize="{StaticResource SmallFontSize}"
                                       Foreground="{StaticResource ControlSecondaryForegroundBrush}">
                                <Run Text="External package references (" />
                                <Run Text="{Binding PackageCount,Mode=OneWay}"
                                     FontWeight="{StaticResource ControlStrongFontWeight}" />
                                <Run Text=" packages) are managed separately and not displayed here." />
                            </TextBlock>
                        </StackPanel>
                        <Button Grid.Column="2"
                                Classes="Primary"
                                Padding="12,6" Command="{Binding $parent[v:InstanceView].NavigateCommand}"
                                CommandParameter="{x:Type v:InstanceSetupView}"
                                VerticalAlignment="Center">
                            <husk:IconLabel Icon="Box" Text="{Binding PackageCount}"
                                            FontSize="{StaticResource MediumFontSize}"
                                            FontWeight="{StaticResource ControlStrongFontWeight}" />
                        </Button>
                    </Grid>
                </husk:InfoBar>
                <Grid Grid.Row="1" ColumnDefinitions="*,4,*" ColumnSpacing="12">
                    <!-- 左侧：Mod 列表 -->
                    <Grid Grid.Column="0" RowDefinitions="Auto,*" RowSpacing="8">
                        <!-- 搜索和过滤栏 -->
                        <TextBox Grid.Row="0"
                                 Watermark="Search mods..."
                                 Text="{Binding ModSearchText,Mode=TwoWay}">
                            <TextBox.InnerRightContent>
                                <StackPanel Orientation="Horizontal">
                                    <Button
                                        IsVisible="{Binding $parent[TextBox].Text,Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                                        Command="{Binding $parent[TextBox].Clear}"
                                        Content="{fie:SymbolIcon Symbol=Dismiss,FontSize={StaticResource MediumFontSize}}"
                                        Foreground="{StaticResource ControlSecondaryForegroundBrush}" />

                                    <!-- 过滤器面板 -->
                                    <Button Classes.Primary="{Binding IsModFilterActive,Mode=OneWay}">
                                        <Button.Flyout>
                                            <Flyout>
                                                <StackPanel Spacing="8" MinWidth="320" MaxWidth="420" Margin="12">
                                                    <TextBlock Text="Filter Conditions"
                                                               FontSize="{StaticResource SmallFontSize}"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                               VerticalAlignment="Center" />

                                                    <!-- 启用与禁用 -->
                                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                                                        <TextBlock Grid.Column="0" Text="Status"
                                                                   VerticalAlignment="Bottom" />
                                                        <TabStrip Grid.Column="1"
                                                                  Theme="{StaticResource SegmentedTabStripTheme}"
                                                                  SelectedItem="{Binding ModFilterEnability,Mode=TwoWay}">
                                                            <TabStrip.ItemTemplate>
                                                                <DataTemplate DataType="m:AssetModEnabilityFilter">
                                                                    <TextBlock Text="{Binding Label}" />
                                                                </DataTemplate>
                                                            </TabStrip.ItemTemplate>
                                                            <m:AssetModEnabilityFilter
                                                                Label="{x:Static lang:Resources.Enum_All}"
                                                                Enability="{x:Null}" />
                                                            <m:AssetModEnabilityFilter
                                                                Label="{x:Static lang:Resources.Enum_Enabled}"
                                                                Enability="{x:True}" />
                                                            <m:AssetModEnabilityFilter
                                                                Label="{x:Static lang:Resources.Enum_Disabled}"
                                                                Enability="{x:False}" />
                                                        </TabStrip>
                                                    </Grid>

                                                    <husk:Divider />

                                                    <!-- 是否上锁 -->
                                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                                                        <TextBlock Grid.Column="0" Text="Source"
                                                                   VerticalAlignment="Bottom" />
                                                        <TabStrip Grid.Column="1"
                                                                  Theme="{StaticResource SegmentedTabStripTheme}"
                                                                  SelectedItem="{Binding ModFilterLockility,Mode=TwoWay}">
                                                            <TabStrip.ItemTemplate>
                                                                <DataTemplate DataType="m:AssetModLockilityFilter">
                                                                    <TextBlock Text="{Binding Label}" />
                                                                </DataTemplate>
                                                            </TabStrip.ItemTemplate>
                                                            <m:AssetModLockilityFilter
                                                                Label="{x:Static lang:Resources.Enum_All}"
                                                                Lockility="{x:Null}" />
                                                            <m:AssetModLockilityFilter
                                                                Label="{x:Static lang:Resources.InstanceSetupView_SourceImportText}"
                                                                Lockility="{x:True}" />
                                                            <m:AssetModLockilityFilter
                                                                Label="{x:Static lang:Resources.InstanceSetupView_SourceLocalText}"
                                                                Lockility="{x:False}" />
                                                        </TabStrip>
                                                    </Grid>

                                                    <husk:Divider />

                                                    <!-- 加载器类型 -->
                                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                                                        <TextBlock Grid.Column="0" Text="Loader"
                                                                   VerticalAlignment="Bottom" />
                                                        <TabStrip Grid.Column="1"
                                                                  Theme="{StaticResource SegmentedTabStripTheme}"
                                                                  SelectedItem="{Binding ModFilterLoader,Mode=TwoWay}">
                                                            <TabStrip.ItemTemplate>
                                                                <DataTemplate DataType="m:AssetModLoaderFilter">
                                                                    <TextBlock Text="{Binding Label}" />
                                                                </DataTemplate>
                                                            </TabStrip.ItemTemplate>
                                                            <m:AssetModLoaderFilter
                                                                Label="{x:Static lang:Resources.Enum_All}"
                                                                Loader="{x:Null}" />
                                                            <m:AssetModLoaderFilter Label="Fabric"
                                                                    Loader="{x:Static m:ModLoaderKind.Fabric}" />
                                                            <m:AssetModLoaderFilter Label="Forge"
                                                                    Loader="{x:Static m:ModLoaderKind.Forge}" />
                                                            <m:AssetModLoaderFilter Label="Quilt"
                                                                    Loader="{x:Static m:ModLoaderKind.Quilt}" />
                                                            <m:AssetModLoaderFilter Label="NeoForge"
                                                                    Loader="{x:Static m:ModLoaderKind.NeoForge}" />
                                                        </TabStrip>
                                                    </Grid>
                                                </StackPanel>
                                            </Flyout>
                                        </Button.Flyout>
                                        <icons:PackIconLucide Kind="ListFilter"
                                                              Height="{StaticResource MediumFontSize}"
                                                              Width="{StaticResource MediumFontSize}" />
                                    </Button>
                                </StackPanel>
                            </TextBox.InnerRightContent>
                        </TextBox>

                        <!-- Mod 列表 -->
                        <ScrollViewer Grid.Row="1">

                            <controls:EmptyContainer
                                IsEmpty="{Binding Mods.Count,Converter={x:Static husk:NumberConverters.IsZero},FallbackValue=True}">

                                <!-- Mod 列表 -->
                                <ListBox Theme="{StaticResource CleanListBoxTheme}" ItemsSource="{Binding Mods}"
                                         SelectionMode="Single"
                                         SelectedItem="{Binding SelectedMod,Mode=TwoWay}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate DataType="m:AssetModModel">
                                            <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                                                <!-- Mod 图标 -->
                                                <Border Grid.Column="0" Width="48" Height="48"
                                                        CornerRadius="{StaticResource SmallCornerRadius}">
                                                    <Border.Background>
                                                        <ImageBrush Source="{Binding Icon}" Stretch="Uniform" />
                                                    </Border.Background>
                                                </Border>

                                                <!-- Mod 信息 -->
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding DisplayName}"
                                                               FontWeight="{StaticResource ControlStrongFontWeight}"
                                                               TextTrimming="CharacterEllipsis" />
                                                    <TextBlock Text="{Binding Version}"
                                                               FontSize="{StaticResource SmallFontSize}"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                    <TextBlock Text="{Binding FileSize}"
                                                               FontSize="{StaticResource SmallFontSize}"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                </StackPanel>

                                                <!-- 状态指示器 -->
                                                <husk:SwitchPresenter Grid.Column="2" Value="{Binding IsLocked}"
                                                                      TargetType="x:Boolean"
                                                                      Width="8" Height="8"
                                                                      VerticalAlignment="Top">
                                                    <husk:SwitchCase Value="{x:False}">
                                                        <husk:SwitchPresenter Value="{Binding IsEnabled}"
                                                                              TargetType="x:Boolean"
                                                                              Width="8" Height="8">
                                                            <husk:SwitchCase Value="{x:True}">
                                                                <Border
                                                                    CornerRadius="4"
                                                                    Background="{StaticResource ControlSuccessBackgroundBrush}" />
                                                            </husk:SwitchCase>
                                                            <husk:SwitchCase Value="{x:False}">
                                                                <Border
                                                                    CornerRadius="4"
                                                                    Background="{StaticResource ControlDangerBackgroundBrush}" />
                                                            </husk:SwitchCase>
                                                        </husk:SwitchPresenter>
                                                    </husk:SwitchCase>
                                                    <husk:SwitchCase Value="{x:True}">
                                                        <Border
                                                            CornerRadius="4"
                                                            Background="{StaticResource ControlWarningBackgroundBrush}" />
                                                    </husk:SwitchCase>
                                                </husk:SwitchPresenter>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </controls:EmptyContainer>
                        </ScrollViewer>
                    </Grid>

                    <!-- 分隔线 -->
                    <GridSplitter Grid.Column="1" Width="2" />

                    <!-- 右侧：详细信息面板 -->
                    <ScrollViewer Grid.Column="2">
                        <husk:PlaceholderPresenter Source="{Binding SelectedMod}">
                            <husk:PlaceholderPresenter.SourceTemplate>
                                <DataTemplate DataType="m:AssetModModel">
                                    <StackPanel Spacing="8">
                                        <!-- Mod 头部 -->
                                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                            <Border Grid.Column="0" Width="82" Height="82"
                                                    CornerRadius="{StaticResource MediumCornerRadius}">
                                                <Border.Background>
                                                    <ImageBrush
                                                        Source="{Binding Icon}"
                                                        Stretch="Uniform" />
                                                </Border.Background>
                                            </Border>
                                            <StackPanel Grid.Column="1" Spacing="4" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding DisplayName}"
                                                           FontSize="{StaticResource ExtraLargeFontSize}"
                                                           FontWeight="{StaticResource ControlStrongFontWeight}"
                                                           TextTrimming="CharacterEllipsis" />
                                                <TextBlock Text="{Binding Author}" TextTrimming="CharacterEllipsis"
                                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <husk:Tag
                                                        Classes="Primary"
                                                        IsVisible="{Binding IsLocked}">
                                                        <husk:IconLabel Icon="LockClosed"
                                                                        Text="{x:Static lang:Resources.InstancePackageButton_ImportTagText}" />
                                                    </husk:Tag>
                                                    <husk:Tag
                                                        Content="{Binding Metadata.LoaderType}"
                                                        IsVisible="{Binding Metadata.LoaderType,Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                                                    <husk:Tag Content="{Binding Version}" />
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>

                                        <!-- 操作按钮 -->
                                        <husk:ButtonGroup>
                                            <Button
                                                Command="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).ToggleModCommand,FallbackValue={x:Null}}"
                                                CommandParameter="{Binding}">
                                                <husk:SwitchPresenter Value="{Binding IsEnabled}"
                                                                      TargetType="x:Boolean">
                                                    <husk:SwitchCase Value="{x:True}">
                                                        <husk:IconLabel Icon="Power"
                                                                        Text="{x:Static lang:Resources.Enum_Disabled}" />
                                                    </husk:SwitchCase>
                                                    <husk:SwitchCase Value="{x:False}">
                                                        <husk:IconLabel Icon="Power"
                                                                        Text="{x:Static lang:Resources.Enum_Enabled}" />
                                                    </husk:SwitchCase>
                                                </husk:SwitchPresenter>
                                            </Button>
                                            <Button
                                                Command="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).OpenFolderCommand,FallbackValue={x:Null}}"
                                                CommandParameter="{Binding FilePath}">
                                                <icons:PackIconLucide Kind="FolderOpen"
                                                                      Height="{StaticResource MediumFontSize}"
                                                                      Width="{StaticResource MediumFontSize}" />
                                            </Button>
                                            <Button
                                                Command="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).DeleteModCommand,FallbackValue={x:Null}}"
                                                CommandParameter="{Binding}">
                                                <icons:PackIconLucide Kind="Trash2"
                                                                      Foreground="{StaticResource ControlDangerForegroundBrush}"
                                                                      Height="{StaticResource MediumFontSize}"
                                                                      Width="{StaticResource MediumFontSize}" />
                                            </Button>
                                        </husk:ButtonGroup>

                                        <!-- Mod 描述 -->
                                        <Border Background="{StaticResource CardBackgroundBrush}"
                                                CornerRadius="{StaticResource MediumCornerRadius}"
                                                Padding="16"
                                                IsVisible="{Binding Metadata.Description, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <StackPanel Spacing="8">
                                                <TextBlock Text="Description"
                                                           FontWeight="{StaticResource ControlStrongFontWeight}" />
                                                <TextBlock
                                                    Text="{Binding Metadata.Description, FallbackValue=No description available}"
                                                    TextWrapping="Wrap" />
                                            </StackPanel>
                                        </Border>

                                        <!-- 详细信息 -->
                                        <Border Background="{StaticResource CardBackgroundBrush}"
                                                CornerRadius="{StaticResource MediumCornerRadius}"
                                                Padding="16">
                                            <StackPanel Spacing="12">
                                                <TextBlock Text="Details"
                                                           FontWeight="{StaticResource ControlStrongFontWeight}" />
                                                <Grid ColumnDefinitions="Auto,*"
                                                      RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto"
                                                      ColumnSpacing="16" RowSpacing="8">
                                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="File Name:"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                    <TextBlock Grid.Row="0" Grid.Column="1"
                                                               Text="{Binding FileName,Mode=OneWay}"
                                                               TextWrapping="Wrap" />

                                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Mod ID:"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                               IsVisible="{Binding Metadata.ModId, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                                                    <TextBlock Grid.Row="1" Grid.Column="1"
                                                               Text="{Binding Metadata.ModId, FallbackValue=Unknown}"
                                                               IsVisible="{Binding Metadata.ModId, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                                                    <TextBlock Grid.Row="2" Grid.Column="0" Text="License:"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                               IsVisible="{Binding Metadata.License, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                                                    <TextBlock Grid.Row="2" Grid.Column="1"
                                                               Text="{Binding Metadata.License, FallbackValue=Unknown}"
                                                               IsVisible="{Binding Metadata.License, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                                                    <TextBlock Grid.Row="3" Grid.Column="0" Text="File Size:"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                    <TextBlock Grid.Row="3" Grid.Column="1"
                                                               Text="{Binding FileSize}" />

                                                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Last Modified:"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                    <TextBlock Grid.Row="4" Grid.Column="1"
                                                               Text="{Binding LastModifiedFormatted}" />

                                                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Status:"
                                                               Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                                    <husk:SwitchPresenter Grid.Row="5" Grid.Column="1"
                                                                          Value="{Binding IsEnabled}"
                                                                          TargetType="x:Boolean">
                                                        <husk:SwitchCase Value="{x:True}">
                                                            <TextBlock Text="{x:Static lang:Resources.Enum_Enabled}"
                                                                       Foreground="{StaticResource ControlSuccessForegroundBrush}" />
                                                        </husk:SwitchCase>
                                                        <husk:SwitchCase Value="{x:False}">
                                                            <TextBlock Text="{x:Static lang:Resources.Enum_Disabled}"
                                                                       Foreground="{StaticResource ControlDangerForegroundBrush}" />
                                                        </husk:SwitchCase>
                                                    </husk:SwitchPresenter>
                                                </Grid>
                                            </StackPanel>
                                        </Border>

                                        <!-- 链接 -->
                                        <Border Background="{StaticResource CardBackgroundBrush}"
                                                CornerRadius="{StaticResource MediumCornerRadius}"
                                                Padding="16"
                                                IsVisible="{Binding Metadata.Homepage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <Button Command="{x:Static m:InternalCommands.OpenUriCommand}"
                                                    CommandParameter="{Binding Metadata.Homepage}">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <husk:IconLabel Icon="Open" Text="Visite Website" />
                                                </StackPanel>
                                            </Button>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </husk:PlaceholderPresenter.SourceTemplate>

                            <!-- 空状态 -->
                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12">
                                <icons:PackIconLucide Kind="Boxes"
                                                      Height="32" Width="32" HorizontalAlignment="Center"
                                                      Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                                <TextBlock Text="Select a mod to view details"
                                           FontSize="{StaticResource LargeFontSize}"
                                           Foreground="{StaticResource ControlSecondaryForegroundBrush}" />
                            </StackPanel>
                        </husk:PlaceholderPresenter>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </TabItem>
        <TabItem Header="{x:Static lang:Resources.AssetKind_ResourcePack}" />
        <TabItem>
            <TabItem.Header>
                <StackPanel Orientation="Horizontal" Spacing="4">
                    <TextBlock Text="{x:Static lang:Resources.AssetKind_Screenshot}" />
                    <husk:PlaceholderPresenter Source="{Binding ScreenshotGroups}">
                        <husk:PlaceholderPresenter.SourceTemplate>
                            <DataTemplate DataType="m:AssetScreenshotCollection">
                                <TextBlock
                                    Text="{Binding ScreenshotCount,StringFormat={}({0}),FallbackValue=(0)}" />
                            </DataTemplate>
                        </husk:PlaceholderPresenter.SourceTemplate>
                        <husk:ProgressRing
                            IsIndeterminate="{Binding ScreenshotGroups,Converter={x:Static ObjectConverters.IsNull}}"
                            Height="{Binding $parent[TabItem].FontSize}" Width="{Binding $parent[TabItem].FontSize}" />
                    </husk:PlaceholderPresenter>
                </StackPanel>
            </TabItem.Header>
            <Panel>
                <StackPanel VerticalAlignment="Center"
                            IsVisible="{Binding ScreenshotGroups.Count,Converter={x:Static husk:NumberConverters.IsZero},FallbackValue=True}"
                            Spacing="8">
                    <icons:PackIconLucide Kind="Image" Height="{StaticResource ExtraLargeFontSize}"
                                          Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                          Width="{StaticResource ExtraLargeFontSize}" HorizontalAlignment="Center" />
                    <TextBlock Text="{x:Static lang:Resources.Shared_EmptyListLabelText}"
                               FontSize="{StaticResource LargeFontSize}"
                               Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                               HorizontalAlignment="Center" />
                </StackPanel>
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding ScreenshotGroups}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="12" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate DataType="m:AssetScreenshotGroupModel">
                                <Border Background="{StaticResource CardBackgroundBrush}" BoxShadow="0 0 4 0 #3F000000"
                                        Margin="2" CornerRadius="{StaticResource MediumCornerRadius}" Width="256"
                                        VerticalAlignment="Top">
                                    <DockPanel>
                                        <TextBlock Text="{Binding Date}" DockPanel.Dock="Top"
                                                   Foreground="{StaticResource ControlSecondaryForegroundBrush}"
                                                   Margin="12,12,12,0" />
                                        <ScrollViewer>
                                            <ItemsControl Margin="12" ItemsSource="{Binding Screenshots}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel Spacing="8" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate DataType="m:AssetScreenshotModel">
                                                        <Border Padding="8"
                                                                Height="178"
                                                                Background="{StaticResource OverlaySolidBackgroundBrush}"
                                                                BorderThickness="1"
                                                                BorderBrush="{StaticResource ControlBorderBrush}"
                                                                CornerRadius="{StaticResource MediumCornerRadius}">
                                                            <Grid RowDefinitions="*,Auto" RowSpacing="8">
                                                                <Button Grid.Row="0"
                                                                        RenderOptions.BitmapInterpolationMode="LowQuality"
                                                                        Command="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).ViewImageCommand,FallbackValue={x:Null}}"
                                                                        CommandParameter="{Binding}">
                                                                    <Button.Theme>
                                                                        <ControlTheme TargetType="Button">
                                                                            <Setter Property="Cursor" Value="Hand" />
                                                                            <Setter Property="CornerRadius"
                                                                                    Value="{StaticResource SmallCornerRadius}" />
                                                                            <Setter Property="Template">
                                                                                <ControlTemplate>
                                                                                    <Panel>
                                                                                        <Border
                                                                                            CornerRadius="{TemplateBinding CornerRadius}"
                                                                                            Background="{TemplateBinding Background}" />
                                                                                        <Border Name="Mask" Opacity="0"
                                                                                            Background="{StaticResource OverlaySmokeBackgroundBrush}"
                                                                                            CornerRadius="{TemplateBinding CornerRadius}">
                                                                                            <Border.Transitions>
                                                                                                <Transitions>
                                                                                                    <DoubleTransition
                                                                                                        Property="Opacity"
                                                                                                        Easing="SineEaseOut"
                                                                                                        Duration="{StaticResource ControlFasterAnimationDuration}" />
                                                                                                </Transitions>
                                                                                            </Border.Transitions>
                                                                                            <icons:PackIconLucide
                                                                                                Kind="View"
                                                                                                HorizontalAlignment="Center"
                                                                                                VerticalAlignment="Center"
                                                                                                Height="36"
                                                                                                Width="36"
                                                                                                Foreground="{StaticResource ControlWhiteForegroundBrush}" />
                                                                                        </Border>
                                                                                    </Panel>
                                                                                </ControlTemplate>
                                                                            </Setter>

                                                                            <Style
                                                                                Selector="^:pointerover /template/ Border#Mask">
                                                                                <Setter Property="Opacity" Value="0.88" />
                                                                            </Style>
                                                                        </ControlTheme>
                                                                    </Button.Theme>
                                                                    <Button.Background>
                                                                        <ImageBrush Source="{Binding Thumbnail}"
                                                                                Stretch="UniformToFill" />
                                                                    </Button.Background>
                                                                </Button>
                                                                <DockPanel Grid.Row="1">
                                                                    <husk:ButtonGroup DockPanel.Dock="Right">
                                                                        <Button
                                                                            Command="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).OpenScreenshotFileCommand,FallbackValue={x:Null}}"
                                                                            CommandParameter="{Binding}">
                                                                            <icons:PackIconLucide Kind="ImagePlay"
                                                                                    Height="{StaticResource SmallFontSize}"
                                                                                    Width="{StaticResource SmallFontSize}" />
                                                                        </Button>
                                                                        <Button
                                                                            Command="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).OpenFolderCommand,FallbackValue={x:Null}}"
                                                                            CommandParameter="{Binding Image.LocalPath}">
                                                                            <icons:PackIconLucide Kind="FolderOpen"
                                                                                    Height="{StaticResource SmallFontSize}"
                                                                                    Width="{StaticResource SmallFontSize}" />
                                                                        </Button>
                                                                        <Button
                                                                            Command="{Binding $parent[v:InstanceAssetsView].((vm:InstanceAssetsViewModel)DataContext).DeleteScreenshotCommand,FallbackValue={x:Null}}"
                                                                            CommandParameter="{Binding}">
                                                                            <icons:PackIconLucide Kind="Trash2"
                                                                                    Foreground="{StaticResource ControlDangerForegroundBrush}"
                                                                                    Height="{StaticResource SmallFontSize}"
                                                                                    Width="{StaticResource SmallFontSize}" />
                                                                        </Button>
                                                                    </husk:ButtonGroup>
                                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                                        <husk:Tag
                                                                            Classes="Primary"
                                                                            IsVisible="{Binding IsLocked}">
                                                                            <husk:IconLabel Icon="LockClosed"
                                                                                    Text="{x:Static lang:Resources.InstancePackageButton_ImportTagText}" />
                                                                        </husk:Tag>
                                                                        <husk:Tag Content="{Binding Time}" />
                                                                    </StackPanel>
                                                                </DockPanel>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </ScrollViewer>
                                    </DockPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Panel>
        </TabItem>
        <TabItem Header="{x:Static lang:Resources.AssetKind_Save}" />
        <TabItem Header="{x:Static lang:Resources.AssetKind_Server}" />
    </TabControl>
</controls:Subpage>
